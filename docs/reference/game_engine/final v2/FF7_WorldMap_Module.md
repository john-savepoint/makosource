---
title: "FF7 WorldMap Module"
module: "World Map"
created: "2025-11-29 18:47 JST"
modified: "2025-12-02 08:40 JST"
session_id: "79804477-cbe0-454d-a65e-1d6043a4024d"
author: "Generated by Claude Code Documentation Standardization Agent"
status: "Complete"

# LLM-specific metadata (CRITICAL for routing)
llm_summary: "Specifies FF7 world map mesh format including MAP/BOT file structures, triangle/vertex data, LZSS compression, walkmap types, and encounter data system. LLMs should read this when parsing world map geometry, implementing terrain collision detection, or debugging encounter rate issues."
llm_tags: ["world-map", "mesh-format", "walkmap", "lzss-compression", "encounter-data", "terrain"]
llm_primary_topics: ["MAP file structure", "Mesh triangle/vertex format", "Walkmap terrain types", "Encounter data system", "LZSS compression"]
llm_related_docs: ["FF7_WorldMap_Module_Script.md", "FF7_World_Map_TXZ.md", "FF7_World_Map_BSZ.md", "FF7_World_Map_Encounters.md", "FF7_LZSS_format.md"]

# Backlinks (leave empty - populated in pass 2)
referenced_by: ["FF7.md", "FF7_Engine_basics.md", "FF7_Technical_Source.md", "FF7_WorldMap_Module_Script.md", "FF7_World_Map_BSZ.md", "FF7_World_Map_Encounters.md", "FF7_World_Map_TXZ.md"]
---

<!--
STANDARDIZATION METADATA
Original: FF7_WorldMap_Module.md
Source: merged_with_pdf_content/FF7_WorldMap_Module.md
Standardized: 2025-12-02 08:40 JST
Session-ID: 79804477-cbe0-454d-a65e-1d6043a4024d
Agent: FF7 Documentation Cleanup Agent v2.0

Previous Merge Metadata:
MERGE METADATA
Created: 2025-11-29 18:47 JST
Merged File: FF7_WorldMap_Module.md
Original Size: 234 lines (~8.2 KB)
Additions: 1 section (Encounter Data System), 65 lines of substantive content
Major Section Source: 07_WORLD_MAP.md (lines 7-71)
Images: 0 images added
Analysis Report: comparisons/FF7_WorldMap_Module_vs_07_WORLD_MAP_analysis.md
Merge Type: Content extraction and integration
No Lorem Ipsum content included
All original content preserved

v2 Cleanup Changes Applied:
- Updated modification timestamp
- Added GitHub-flavored markdown alerts for important notes
- Improved table formatting with consistent alignment
- Enhanced code block documentation
- Fixed italic emphasis in table cells
- Preserved all technical content and contributor attributions

LLM CONTEXT BLOCK (Read this first for routing decisions):
This document provides the complete technical specification for FF7's world map mesh format,
including the MAP and BOT file structures, LZSS compression scheme, triangle/vertex data formats,
walkmap terrain types (32 types controlling vehicle and character movement), and the encounter
data system that determines random battle rates and formations across 16 geographic areas.
Related documents cover scripting (FF7_WorldMap_Module_Script.md), textures (FF7_World_Map_TXZ.md),
and detailed encounter tables (FF7_World_Map_Encounters.md).
-->

# FF7 WorldMap Module

## Preamble

The following was originaly described by Tonberry, in qhimm's forum. It was completed by Ficedula sometimes later, who reversed texture data.

*Additions in italics by Aali*

### Two formats

BOT and MAP files are similar; BOT files are redundant and look like optimized versions of the corresponding MAP files.

> [!NOTE]
> MAP file follows the structure described below and is used to load single blocks on demand. BOT file contains the same blocks but arranged to speed up initial load time by storing each block and 3 of its neighboring blocks together.

*For instance, the data stored for the first 2 blocks is (numbers refer to the MAP layout below): 0,1,9,10 then 1,2,10,11. This pattern repeats up to block #62. Replacement blocks 63-68 are divided in groups for each replacement, i.e. block 64 and 65 are part of the same group since they both belong to the Ultima Weapon crater. These groups are then stored using the same algorithm as above, each 4-block group containing a replaced block is written out again. 1-block replacements thus add 4×4 blocks to the .BOT file while 2-block replacements add 6×4 blocks. Replacements are to be made **in order**, when writing the data for the Ultima Weapon crater the Temple of the Ancients should be gone and so on. All of this adds up to 63×4 + 4×4 + 6×4 + 4×4 + 6×4 = 332 blocks.*

### Content

| File | Description |
|:-----|:------------|
| WM0 | Above water map |
| WM2 | Underwater (submarine) map |
| WM3 | Snowstorm map |

## MAP Format

### File Structure

A worldmap file is divided in sections of `0xB800` bytes, each section representing a square block of the map.

#### Map Block

Each block consists in 16 meshes, organized in a grid-like fashion:

*Map Block mesh arrangement*

|  Col 0  |  Col 1  |  Col 2  |  Col 3  |
|:-------:|:-------:|:-------:|:-------:|
|    0    |    1    |    2    |    3    |
|    4    |    5    |    6    |    7    |
|    8    |    9    |   10    |   11    |
|   12    |   13    |   14    |   15    |

A block is recorded following the structure (all pointers are expressed in bytes relative to offset 0 of block):

> [!IMPORTANT]
> Pointers have to be aligned to 4-byte boundaries. FF7 ignores the last two bits when reading the file.

For each m in 16 meshes:

| Size | Description |
|:----:|:------------|
| 4 bytes | Pointer to compressed data for mesh m |

Followed by, for each m in 16 meshes:

| Size | Description |
|:--------:|:------------|
| variable | Compressed data for mesh m |

The data for each mesh is independently compressed using LZSS, so the first 4 bytes are the size in bytes of the compressed data and the rest is the compressed data itself.

#### WM0.MAP

wm0.map contains 68 blocks. The first 63 of them are arranged in a grid-like fashion, made of 7 rows of 9 columns, like this:

*wm0.map block arrangement*

| Col 0 | Col 1 | Col 2 | Col 3 | Col 4 | Col 5 | Col 6 | Col 7 | Col 8 |
|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
|   0   |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |
|   9   |  10   |  11   |  12   |  13   |  14   |  15   |  16   |  17   |
|  18   |  19   |  20   |  21   |  22   |  23   |  24   |  25   |  26   |
|  27   |  28   |  29   |  30   |  31   |  32   |  33   |  34   |  35   |
|  36   |  37   |  38   |  39   |  40   |  41   |  42   |  43   |  44   |
|  45   |  46   |  47   |  48   |  49   |  50   |  51   |  52   |  53   |
|  54   |  55   |  56   |  57   |  58   |  59   |  60   |  61   |  62   |

The last 5 meshes 63, 64, 65, 66, 67 and 68 replaces meshes 50, 41, 42, 60, 47 and 48 (respectively), according to the story of the game.

### Mesh Structure

A worldmap mesh is recorded like this:

#### Header

*Header Structure*

| Size | Description |
|:----:|:------------|
| 2 bytes | Number of triangles |
| 2 bytes | Number of vertices |

```c
typedef struct
{
    uint16 NumberOfTriangles;
    uint16 NumberOfVertices;
} WorldMeshHeader;
```

#### Triangle

*For each triangle t in "number of triangles"*

| Size | Description |
|:----:|:------------|
| 1 byte | Index of vertex 0 of triangle t |
| 1 byte | Index of vertex 1 of triangle t |
| 1 byte | Index of vertex 2 of triangle t |
| 5 bits (lowest) | Walkmap status of triangle t (see below) |
| 3 bits | Unknown, probably script related |
| 1 byte | Coordinate u in texture for vertex 0 |
| 1 byte | Coordinate v in texture for vertex 0 |
| 1 byte | Coordinate u in texture for vertex 1 |
| 1 byte | Coordinate v in texture for vertex 1 |
| 1 byte | Coordinate u in texture for vertex 2 |
| 1 byte | Coordinate v in texture for vertex 2 |
| 9 bits (lowest) | Texture (see below) |
| 7 bits | Location (message ID that will be displayed in menus and savegames) |

```c
typedef struct
{
    uint8 Vertex0Index;
    uint8 Vertex1Index;
    uint8 Vertex2Index;
    uint8 WalkabilityInfo : 5;  // contributor addition
    uint8 Unknown : 3;          // contributor addition
    uint8 uVertex0, vVertex0;
    uint8 uVertex1, vVertex1;
    uint8 uVertex2, vVertex2;
    uint16 TextureInfo : 9;     // contributor addition
    uint16 Location : 7;        // contributor addition
} WorldMeshTriangle;
```

#### Vertex

*For each vertex v in "number of vertices"*

| Size | Description |
|:----:|:------------|
| 2 bytes | Coordinate x of vertex v (signed) |
| 2 bytes | Coordinate y of vertex v (signed) |
| 2 bytes | Coordinate z of vertex v (signed) |
| 2 bytes | Unknown: Coordinate w of vertex v? *Never used in PC version.* |

```c
typedef struct
{
    int16 X, Y, Z;
    uint16 Unused;  // fill to fit structure to 32-bit boundary
} VertexType;
```

#### Normal

*For each vertex v in "number of vertices"*

| Size | Description |
|:----:|:------------|
| 2 bytes | Coordinate x of normal for vertex v |
| 2 bytes | Coordinate y of normal for vertex v |
| 2 bytes | Coordinate z of normal for vertex v |
| 2 bytes | Unknown: Coordinate w of normal for vertex v? *Always 0, never used in PC version.* |

```c
typedef struct
{
    int16 X, Y, Z;
    uint16 Unused;  // fill to fit structure to 32-bit boundary
} NormalType;
```

*Structures added by [Cyberman](https://wiki.ffrtt.ru/index.php/User:Cyberman) 13:43, 10 Jan 2007 (CST)*

---

## Encounter Data System (PC Format)

### Overview

The world map also contains encounter data beyond the mesh geometry. While dialogue data is stored in 'mes' files and event files are in 'wm0.ev', 'wm2.ev' and 'wm3.ev' (for the respective world maps), the encounter data is stored in 'enc_w.bin' (though encounter distributions may follow different rules than field-based encounters).

### Encounter Data Structure

Encounter data for the World Map starts at offset `0xB8`, with each section being 32 bytes in length. A section is defined as follows:

| Offset | Size | Description |
|:------:|:----:|:------------|
| 0x00 | 1 byte | Unknown (always `0x01`) |
| 0x01 | 1 byte | Encounter Rate (lower numbers = higher encounter rates) |
| 0x02-0x0D | 12 bytes (2 bytes × 6) | Normal Battle + Chance of that battle (6 records) |
| 0x0E-0x15 | 8 bytes (2 bytes × 4) | Special Formation Battles + Chance (4 records) |
| 0x16-0x1F | 10 bytes (2 bytes × 5) | Chocobo Battles (5 records) |

> [!NOTE]
> The chance byte for normal battles appears to always add up to 64 total probability.

### Area Field Organization

Each area in the game has four distinct field types, aligned in the following arrangement:

1. Area - Grass
2. Area - Dirt/Snow
3. Area - Forest/Desert
4. Area - Beach

### Geographic Areas

The world map is divided into the following areas, each with its own encounter data:

| # | Area Name | Notes |
|:-:|:----------|:------|
| 1 | Midgar Area | — |
| 2 | Kalm Area | — |
| 3 | Junon Area | — |
| 4 | Corel Area | — |
| 5 | Gold Saucer Area | — |
| 6 | Gongaga Area | — |
| 7 | Cosmo Area | — |
| 8 | Nibel Area | — |
| 9 | Rocket Area | — |
| 10 | Wutai Area | — |
| 11 | Woodlands Area | — |
| 12 | Icicle Area | Forests in this area have no encounters |
| 13 | Mideel Area | — |
| 14 | North Corel Area | Materia Cave north of Corel |
| 15 | Cactus Island | — |
| 16 | Goblin Island | Lacks a full empty Beach encounter list |

---

## Walkmap

Each triangle can have one of the 32 different walkmap types described below.

| Code | Type | Description |
|:----:|:-----|:------------|
| 0 | Grass | Most things can go here. |
| 1 | Forest | No landing here, but anything else goes. |
| 2 | Mountain | Chocobos and flying machines only. |
| 3 | Sea | Deep water, only gold chocobo and submarine can go here. |
| 4 | River Crossing | Buggy, tiny bronco and water-capable chocobos. |
| 5 | River | Tiny bronco and chocobos. |
| 6 | Water | Shallow water, same as above. |
| 7 | Swamp | Midgar zolom can only move in swamp areas. |
| 8 | Desert | No landing. |
| 9 | Wasteland | Found around Midgar, Wutai and misc other. No landing. |
| 10 | Snow | Leaves footprints, no landing. |
| 11 | Riverside | Beach-like area where river and land meet. |
| 12 | Cliff | Sharp drop, usually where the player can be on either side. |
| 13 | Corel Bridge | Tiny bridge over the waterfall from Costa del Sol to Corel. |
| 14 | Wutai Bridge | Rickety rope bridges south of Wutai. |
| 15 | Unused | Doesn't seem to be used anywhere in the original data. |
| 16 | Hill side | This is the tiny walkable part at the foot of a mountain. |
| 17 | Beach | Where land and shallow water meets. |
| 18 | Sub Pen | Only place where you can enter/exit the submarine. |
| 19 | Canyon | The ground in cosmo canyon has this type, walkability same as wasteland. |
| 20 | Mountain Pass | The small path through the mountains connecting Costa del Sol and Corel. |
| 21 | Unknown | Present around bridges, may have some special meaning. |
| 22 | Waterfall | River type where the tiny bronco can't go. |
| 23 | Unused | Doesn't seem to be used anywhere in the original data. |
| 24 | Gold Saucer Desert | Special desert type for the golden saucer. |
| 25 | Jungle | Walkability same as forest, used in southern parts of the map. |
| 26 | Sea (2) | Special type of deep water, only used in one small spot next to HP-MP cave, possibly related to the underwater map/submarine. |
| 27 | Northern Cave | Inside part of the crater, where you can land the highwind. |
| 28 | Gold Saucer Desert Border | Narrow strip of land surrounding the golden saucer desert. Probably related to the "quicksand" script. |
| 29 | Bridgehead | Small area at both ends of every bridge. May have some special meaning. |
| 30 | Back Entrance | Special type that can be set unwalkable from the script. |
| 31 | Unused | Doesn't seem to be used anywhere in the original data. |

---

## Texture

The lower 9 bits contain a texture number (0-511, but only 0-281 appear to be used).

> [!WARNING]
> Knowing which texture to use is not enough. The UV coordinates found in the mesh data are (presumably) the original PSX VRAM coordinates, so to get the real coordinates you must subtract a texture-specific offset from each of the UV pairs.

A complete table with every texture, its original size and offsets can be found in the [WorldMap Texture Table](FF7_World_Map_TXZ.md).

> [!NOTE]
> Sometimes you will end up with negative values after subtracting the offsets. This is normal—the texture should be assumed to repeat itself indefinitely in all directions.
