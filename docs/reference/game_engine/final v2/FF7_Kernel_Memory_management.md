---
title: "FF7/Kernel/Memory management"
module: "Kernel"
created: "2025-11-28 00:00 JST"
modified: "2025-12-02 01:32 JST"
session_id: "f9d4e505-2d51-4e70-9bb0-0bf5a38ed9e9"
author: "Generated by Claude Code Documentation Standardization Agent"
status: "Complete"

# LLM-specific metadata (CRITICAL for routing)
llm_summary: "Documents FF7's memory management architecture including Savemap structure, field script bank mappings, VRAM organization, and PSX CD-ROM access patterns. LLMs should read this when debugging save/load issues, understanding field variable allocation, analyzing texture caching, or investigating memory-related game behavior."
llm_tags: ["memory-management", "savemap", "vram", "psx", "field-script-banks", "texture-cache"]
llm_primary_topics: ["Savemap memory structure", "Field script memory banks", "VRAM texture caching", "PSX CD-ROM sector access"]
llm_related_docs: ["FF7_Savemap.md", "FF7_Field_Module.md", "FF7_Kernel_Overview.md", "FF7_Kernel_Low_level_libraries.md", "PSX_TIM_format.md"]

# Backlinks (leave empty - populated in pass 2)
referenced_by: []
---

<!--
STANDARDIZATION METADATA
Original: FF7_Kernel_Memory_management.md
Source: merged_with_pdf_content/FF7_Kernel_Memory_management.md
Standardized: 2025-12-02 01:32 JST
Session-ID: f9d4e505-2d51-4e70-9bb0-0bf5a38ed9e9
Agent: FF7 Documentation Cleanup Agent v2.0

Previous Merge Metadata:
- Status: Content merged from major section 03_KERNEL.md
- Source File: /docs/reference/game_engine/extracted_major_sections/03_KERNEL.md (Lines 27-77)
- Merge Date: 2025-11-28
- Merge Session: FF7 Game Engine Documentation Consolidation
- Original Content Preserved: Yes - All original content maintained verbatim
- Analysis Report: /docs/reference/game_engine/comparisons/FF7_Kernel_Memory_management_vs_03_KERNEL_analysis.md
- Key Notes: CRITICAL: Bank 5 memory values differ between versions (see analysis report)
  - Individual file (this version): 0xF (8-bit) | 0x7 (16-bit)
  - Major section: 0x7 (8-bit) | 0xF (16-bit)
  - Requires source verification before finalizing
- Capitalization: Individual file uses "Savemap" vs Major section "Save Map"
- No content conflicts - sections are substantially identical

Cleanup Pass (v2.0) Applied:
- Updated session_id and modified date for v2 cleanup
- Added GitHub alert for Bank 5 data discrepancy warning
- Converted temporary field variables note to GFM alert format
- Improved table column alignment (left-align descriptions for readability)
- Verified no corrupted characters (ï¿½) present
- Verified no LaTeX math rendering issues
- All technical content preserved verbatim

LLM CONTEXT BLOCK (Read this first for routing decisions):
This document covers FF7's memory management subsystem, which is critical for understanding
how the game persists state (Savemap), allocates field script variables across 5 memory banks
(accessible via 8-bit or 16-bit field commands), organizes VRAM for texture caching on PSX
(1024x512 virtual layout with double-buffering and CLUT palettes), and handles low-level
CD-ROM access without blocking BIOS calls. Related to save/load functionality, field scripting,
and graphics pipeline. Cross-reference FF7_Savemap.md for complete memory map, FF7_Field_Module.md
for field scripting details, and PSX_TIM_format.md for texture format specifications.
-->

# FF7/Kernel/Memory management

## RAM Management

No matter what module is banked into memory, there is a section of memory 4,340 bytes long (0x10F4 bytes) that is reserved for all the variables for the entire game. This entire image is called the [[Savemap]]. When it's time to save a game, this section of memory is copied to non-volatile ram, such as a hard disk or memory card.

Within the [[Savemap]] there are 5 banks of memory that are directly accessible by the [[field scripting language]]. These can either be accessed 8 bits or 16 bits at a time depending on the field command argument. The following table is basic memory map of the banks and how they relate to the [[Savemap]]. There is also an allocation for 256 bytes for temporary field variables. These are not used between field files and are not saved.

> [!WARNING]
> **Data Discrepancy**: Bank 5 values differ between documentation sources. This version shows `0xF` (8-bit) and `0x7` (16-bit), while the major section shows the inverse (`0x7` / `0xF`). Verify against source before relying on these values.

| Offset | 8-Bit Field Bank | 16-Bit Field Bank | Description                    |
|:------:|:----------------:|:-----------------:|:-------------------------------|
| 0x0000 | N/A              | N/A               | Beginning of [[Savemap]]       |
| 0x0BA4 | 0x1              | 0x2               | Field Script Bank 1            |
| 0x0CA4 | 0x3              | 0x4               | Field Script Bank 2            |
| 0x0DA4 | 0xB              | 0xC               | Field Script Bank 3            |
| 0x0EA4 | 0xD              | 0xE               | Field Script Bank 4            |
| 0x0FA4 | 0xF              | 0x7               | Field Script Bank 5            |
| 0x10F4 | N/A              | N/A               | End of [[Savemap]]             |

> [!NOTE]
> **Temporary Field Variables**: Bank `0x5` (8-bit) / `0x6` (16-bit) provides 256 bytes for temporary field variables. These are **not persisted** to save files and are reset between field files.

A more complete and annotated save map is available in the [Menu Module documentation](FF7_Menu_Module.md#vi-the-save-game-format) and the dedicated [Savemap reference](FF7_Savemap.md).

## VRAM Management

The kernel is in charge of allocating, caching, and displaying in Video RAM. In the case of the PSX port, the PlayStation only has 1 megabyte of VRAM which makes this task a little complex. This is alleviated somewhat by using the PSX's VRAM caching system.

The PSX video memory can best be seen as a rectangular "surface" made up of 2048×512 pixels. A slight caveat to this model is that the PSX can hold multiple color depths in VRAM at the same time. To make the VRAM a little easier to visualize, this document represents VRAM as a 1024×512 matrix to allow for some color depth in either direction and to minimize some extreme skewing of the video buffers.

The following is a typical state of VRAM during game play:

![VRAM state during gameplay showing video buffers, field graphics, cached textures, and permanent menu textures](../images/Gears_img_3.jpg)

The two game screens on the left side are the video buffer and the back buffer. The patchwork of graphics on the top right are the field graphics for that scene. The bottom row consists of cached graphics and special effects and on right semi-permanent and permanent textures for the game.

The following is a schematic representation of VRAM and all its texture boundaries:

![VRAM schematic showing texture boundaries, frame buffers (cyan), CLUT areas (magenta), and cache regions](../images/Gears_img_4.jpg)

Here the sections of VRAM are much more visible:

| Color         | Area                  | Description                                                                                                  |
|:--------------|:----------------------|:-------------------------------------------------------------------------------------------------------------|
| **Cyan**      | Video frame buffers   | The PSX uses a standard double page buffer to animate the game                                               |
| *Blank*       | Above/below buffers   | Reserved for correct V-sync                                                                                  |
| **Dark blue** | Extended display area | 24-bit movie playback; overwrites first two texture caches. During non-movie gameplay, textures placed here |
| **Magenta**   | CLUT area             | Color Look Up Tables (palettes) allowing multiple color depths simultaneously                                |
| **Red**       | Extra CLUT space      | Additional CLUT space when needed and no textures are cached there                                           |
| **Green**     | Permanent textures    | Menu textures that persist across scenes                                                                     |
| **Yellow**    | Menu font location    | Font glyph textures for menu rendering                                                                       |
| *Blank rects* | Texture cache         | Cache boundaries for volatile textures                                                                       |

In order of volatility, the top two rows of cache space are overwritten from left to right, and then the bottom rows are overwritten. The textures on the bottom right are barely overwritten except for key places.

## PSX CD-ROM Management

One of the big rules on PSX development is that direct hardware access is prohibited. Everything must go through the BIOS or the program will risk being incompatible with later systems. This means not only from PSX to PS2, but also all the trivial hardware revisions as well. This creates a problem for the kernel. During module transitions (for example, going from "Map" to "Battle"), the engine actually "preloads" the next module while the current one is still executing. This loading of data can't be done with a simple `open()` or `read()` BIOS syscall. Whenever you enter the BIOS, the rest of the system comes to a screeching halt until it is exited.

> [!IMPORTANT]
> FF7 solves this problem by controlling CD-ROM access itself through faster, low-level BIOS calls. In this "quick mode":
> - The kernel can only load **8 kilobytes** at a time
> - Files are referenced by **sector number**, not filename
> - This allows background loading without blocking the main game loop

---

## Related Documentation

- [Savemap](FF7_Savemap.md) - Complete memory map and bank documentation
- [Field Module](FF7_Field_Module.md) - Field scripting language and variables
- [Kernel Overview](FF7_Kernel_Overview.md) - Kernel architecture overview
- [Low Level Libraries](FF7_Kernel_Low_level_libraries.md) - Archive formats and compression
- [PSX TIM Format](PSX_TIM_format.md) - Texture format specifications
