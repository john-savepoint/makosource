[{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"9bf527c9-7039-4e0c-870d-b19440f2cd83","hook_name":"SessionStart:Callback","hook_event":"SessionStart","stdout":"","stderr":""},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"7da735d3-c8a9-4cb9-a179-44b67c007092","hook_name":"SessionStart:startup","hook_event":"SessionStart","stdout":"","stderr":"","exit_code":0},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"9b558112-af38-4cb9-ac22-3c8d6812aa10","hook_name":"SessionStart:Callback","hook_event":"SessionStart","stdout":"","stderr":""},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"ce0c01ed-07d8-471c-b569-ee90615965cc","hook_name":"SessionStart:startup","hook_event":"SessionStart","stdout":"inject-session-id.sh > injected session ID: 9d128d40-e74f-408a-9202-20f4ea22b8a8 [source: startup]\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SessionStart\",\n    \"additionalContext\": \"**Session ID**: `9d128d40-e74f-408a-9202-20f4ea22b8a8`\\n\\nSession data stored at: `.claude/data/sessions/9d128d40-e74f-408a-9202-20f4ea22b8a8.json`\\n\"\n  }\n}\n","stderr":"","exit_code":0},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"82684261-3882-4cef-ac43-2fa84268da41","hook_name":"SessionStart:startup","hook_event":"SessionStart","stdout":"Claude-9d128d40 tracked in tmux ff70G-japanese-mod:56:%58\n","stderr":"","exit_code":0},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"7e8bf771-7bdd-43bd-89f2-d95cbf6e9383","hook_name":"SessionStart:startup","hook_event":"SessionStart","stdout":"play-startup-sound.sh > ðŸŽ® playing startup sound [source: startup, session: 9d128d40...]\n","stderr":"","exit_code":0},{"type":"system","subtype":"hook_response","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"c7626ca4-d519-4290-bc41-8c075cd483a3","hook_name":"SessionStart:startup","hook_event":"SessionStart","stdout":"inject-session-context.sh > Context injected: /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod on main (35 untracked, 23 modified) [~1479 tokens]\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SessionStart\",\n    \"additionalContext\": \"# Session Start Dynamic Context\\n**Updated**: 2025-12-01 23:01:53 JST (Monday)\\n**ISO 8601**: 2025-12-01T14:01:53Z\\n\\n## Current Working Directory\\n`/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod`\\n\\n\\n\\n## Git Repository Status\\n- **Current Branch**: `main`\\n- **Last Commit**: 1b7b34a - fix(scripts): fix two critical bugs in launch_standardization_agents.sh (22 minutes ago)\\n- **Untracked Files**: 35\\n- **Remote**: makosource\\tgit@github.com:john-savepoint/makosource.git (fetch)\\n\\n## Project Directory Structure (JSON)\\n\\n**Algorithm**: Levenshtein similarity ratio + semantic pattern detection\\n**Exclusions**: .gitignore patterns + hardcoded common patterns (node_modules, .git, dist, build, coverage, __pycache__)\\n**Truncation**:\\n- Files with â‰¥50% name similarity grouped (e.g., `test1.ts`, `test2.ts` â†’ `+N`)\\n- Non-semantic patterns hidden (UUIDs, session IDs, hashes, logs, tmp files)\\n- Semantic files always preserved (package.json, tsconfig.json, README.md, src/*.ts)\\n- Max depth: 2-4 levels (adaptive based on size, targets <15k tokens)\\n\\n**Reading**: `\\\"f\\\":[\\\"file.ts\\\",\\\"+5\\\"]` = 1 shown file + 5 similar/non-semantic files hidden\\n**Critical**: Source files (`src/**/*.ts`) never truncated via similarity, only via depth limits\\n\\n```json\\n{\\\".claude\\\":{\\\"data\\\":{\\\"ff7-docs-context\\\":{\\\"f\\\":[\\\"agent_summaries.json\\\",\\\"document_categories.json\\\",\\\"+4\\\"]},\\\"sessions\\\":{\\\"f\\\":[\\\"0442c7ca-eff1-466c-93f8-f629ccf6ddfb.json\\\",\\\"0cc720b2-3ab5-42f5-9a3c-7c40de6aa93e.json\\\",\\\"+2\\\"]}},\\\"logs\\\":{\\\"f\\\":[\\\"bash-output.log\\\",\\\"skill-usage.log\\\"]},\\\"tmp\\\":{\\\"agent-prompts\\\":{\\\"f\\\":[\\\"FF7_Battle_Battle_Animation_PC_output.json\\\",\\\"FF7_Battle_Battle_Animation_PC_prompt.txt\\\",\\\"+8\\\"]}}},\\\"FF7-Japanese-Mod\\\":{\\\".claude\\\":{\\\"data\\\":{\\\"sessions\\\":{\\\"f\\\":[\\\"0ba935f5-efe0-457c-ad7e-c18f89cfba18.json\\\"]}}},\\\"f\\\":[\\\"Readme.txt\\\",\\\"mod.xml\\\"]},\\\"archive\\\":{\\\"character_tables_debug\\\":{\\\"debug_cells\\\":{\\\"f\\\":[\\\"inv_jafont_1_idx006_gxy6_0.png\\\",\\\"inv_jafont_1_idx116_gxy4_7.png\\\",\\\"+32\\\"]}},\\\"character_tables_pre-interactive\\\":{\\\"f\\\":[\\\"character_map.csv\\\",\\\"character_map.json\\\",\\\"mapping_discrepancies.csv\\\",\\\"ocr_confidence.json\\\",\\\"+4\\\"]},\\\"character_tables_verification\\\":{\\\"verification\\\":{\\\"f\\\":[\\\"jafont_1_comparison.png\\\",\\\"jafont_1_generated.png\\\",\\\"+16\\\"]},\\\"verification_topleft\\\":{\\\"f\\\":[\\\"jafont_1_comparison_topleft.png\\\",\\\"jafont_1_mangaocr_topleft.png\\\",\\\"+10\\\"]}},\\\"findings_legacy\\\":{\\\"f\\\":[\\\"FINDINGS.md\\\",\\\"FINDINGS.md.backup\\\",\\\"findings2.md\\\"]},\\\"scripts\\\":{\\\"f\\\":[\\\"compare_mappings.py\\\",\\\"debug_mangaocr_cells.py\\\",\\\"generate_accurate_charmap.py\\\",\\\"manga_ocr_mapper.py\\\",\\\"measure_actual_glyph_size.py\\\",\\\"reassemble_findings.py\\\",\\\"+10\\\"]},\\\"sharded\\\":{\\\"bible\\\":{},\\\"bible_sections\\\":{\\\"f\\\":[\\\"1-executive-mission-briefing.md\\\",\\\"10-advanced-feature-furigana-support.md\\\",\\\"11-testing-verification-protocol.md\\\",\\\"12-risk-mitigation-debugging-guide.md\\\",\\\"14-reference-materials-appendices.md\\\",\\\"2-architectural-overview-strategic-analysis.md\\\",\\\"4-asset-specifications-data-structures.md\\\",\\\"5-ffnx-codebase-architecture.md\\\",\\\"6-deep-dive-technical-constraints-solutions.md\\\",\\\"7-implementation-specification-c-modifications.md\\\",\\\"conclusion.md\\\",\\\"index.md\\\",\\\"+6\\\"]},\\\"findings\\\":{},\\\"findings_sections\\\":{\\\"f\\\":[\\\"00_INDEX.md\\\",\\\"01_executive_summary.md\\\",\\\"06_ff7_text_system_architecture.md\\\",\\\"12_potential_implementation_approaches.md\\\",\\\"13_required_modifications.md\\\",\\\"14_development_roadmap_considerations.md\\\",\\\"17_next_steps.md\\\",\\\"18_conclusion.md\\\",\\\"27_breakthrough_first_ever_ff7_japanese_character_table_created.md\\\",\\\"+21\\\"]},\\\"f\\\":[\\\"README.md\\\",\\\"shard_findings.py\\\"]},\\\"f\\\":[\\\"ARCHITECTURAL_RETROSPECTIVE.md\\\",\\\"SCRAPED_URLS.md\\\",\\\"TOOL_VERIFICATION_LOG.md\\\",\\\"UNSCRAPPED_URLS.md\\\"]},\\\"assets\\\":{\\\"character_mappings\\\":{\\\"interactive_viewer\\\":{\\\"f\\\":[\\\"all_textures_corrections.json\\\",\\\"jafont_1_corrections (1).json\\\",\\\"jafont_6_final.json\\\",\\\"+11\\\"]}}},\\\"docs\\\":{\\\"character_maps\\\":{\\\"f\\\":[\\\"JAFONT_CHARACTER_MAP.md\\\",\\\"ff7_complete_mapping_compact.csv\\\"]},\\\"recent\\\":{},\\\"reference\\\":{\\\"game_engine\\\":{\\\".claude\\\":{},\\\"comparisons\\\":{\\\"f\\\":[\\\"CRITICAL_DISCREPANCIES_REQUIRING_INVESTIGATION.md\\\",\\\"FF7_Battle_Battle_Animation_PC_vs_06_BATTLE_MODULE_analysis.md\\\",\\\"FF7_Battle_Battle_Field_vs_06_BATTLE_MODULE_analysis.md\\\",\\\"repomix-comparisons-markdown.md\\\",\\\"+36\\\"]},\\\"extracted_major_sections\\\":{\\\"f\\\":[\\\"00_HEADER_TOC.md\\\",\\\"01_HISTORY.md\\\",\\\"06_BATTLE_MODULE.md\\\",\\\"11_BUGS_AND_CREDITS.md\\\",\\\"+10\\\"]},\\\"final\\\":{\\\"f\\\":[\\\"FF7_Battle_Battle_Animation_PC.md\\\",\\\"FF7_Battle_Battle_Field.md\\\",\\\"+1\\\"]},\\\"images\\\":{\\\"f\\\":[\\\"Engine_parts.jpg\\\",\\\"Field_BackgroundVRAM.jpg\\\",\\\"Gears_img_3.jpg\\\",\\\"+25\\\"]},\\\"markdown\\\":{\\\"f\\\":[\\\"FF7.md\\\",\\\"FF7_Chocobo_Breeding.md\\\",\\\"FF7_History.md\\\",\\\"FF7_Item_Materia_Reference.md\\\",\\\"+32\\\"]},\\\"raw\\\":{\\\"f\\\":[\\\"FF7.mediawiki\\\",\\\"FF7_Battle_Battle_Field.mediawiki\\\",\\\"+30\\\"]},\\\"f\\\":[\\\"AGENT_COMPARISON_GUIDE.md\\\",\\\"ENHANCEMENT_PLAN.md\\\",\\\"FINAL_CONVERSION_PIPELINE.md\\\",\\\"Playstation Battle Model Format.md\\\",\\\"combine_files.sh\\\",\\\"copy-paste from ff7 wiki.md\\\",\\\"ff7 game engine_meta.json\\\",\\\"links to copy in order.txt\\\",\\\"move_toc_below_heading.py\\\",\\\"scraper.py\\\",\\\"+59\\\"]},\\\"f\\\":[\\\"AF3DN_ANALYSIS.md\\\",\\\"ARCHITECTURE_CLARIFICATION.md\\\",\\\"BEGINNER_GUIDE.md\\\",\\\"MULTI_LANGUAGE_FINDINGS.md\\\",\\\"TOOL_GUIDE.md\\\",\\\"VERIFICATION_FINDINGS_SESSION_11.md\\\"]},\\\"roadmap\\\":{\\\"f\\\":[\\\"FEATURE_ROADMAP.md\\\",\\\"FFNX_CROWDSOURCED_TRANSLATION_SPEC.md\\\"]},\\\"f\\\":[\\\"7TH_HEAVEN_DEVELOPER_GUIDE.md\\\",\\\"BUILD_ENVIRONMENT_SETUP.md\\\",\\\"DOCUMENTATION_UPDATE_PLAN.md\\\",\\\"FFNX_DEVELOPER_GUIDE.md\\\",\\\"PR737_files_summary.txt\\\",\\\"README.md\\\",\\\"To-do list for documentation.md\\\",\\\"masterfindings.md\\\",\\\"+11\\\"]},\\\"japanese-assets-extracted\\\":{\\\"mod-structure\\\":{},\\\"f\\\":[\\\"FFNx-japanese.toml\\\",\\\"README.md\\\",\\\"TRANSFER_CHECKLIST.md\\\",\\\"WINDOWS_INSTALLATION_GUIDE.md\\\"]},\\\"reference\\\":{\\\"repomix_snapshots\\\":{\\\"f\\\":[\\\"FFNx_repomix.md\\\"]}},\\\"scripts\\\":{\\\"f\\\":[\\\"AGENT_LAUNCHER_USAGE.md\\\",\\\"BUG_FIXES.md\\\",\\\"extract_doc_context.py\\\",\\\"launch_standardization_agents.sh\\\"]},\\\"f\\\":[\\\"DOCUMENTATION_MAP.md\\\",\\\"README.md\\\",\\\"SIMPLE_INSTRUCTIONS.md\\\",\\\"claude.md\\\"]}\\n```\\n\\n## Tmux Environment\\n- **Session**: `ff70G-japanese-mod` (`$7`)\\n- **Window**: `claude-9d128d40` (`@56` / index: 8)\\n- **Pane**: `%58`\\n\\n---\\n*This context was automatically injected at session start to provide current state information.*\\n\"\n  }\n}\n","stderr":"","exit_code":0},{"type":"system","subtype":"init","cwd":"/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","tools":["Task","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","BashOutput","KillShell","Skill","SlashCommand","EnterPlanMode","mcp__context7__resolve-library-id","mcp__context7__get-library-docs","mcp__tmux__list-sessions","mcp__tmux__find-session","mcp__tmux__list-windows","mcp__tmux__list-panes","mcp__tmux__capture-pane","mcp__tmux__create-session","mcp__tmux__create-window","mcp__tmux__execute-command","mcp__tmux__get-command-result","ListMcpResourcesTool","ReadMcpResourceTool","mcp__interactive-send-and-capture__send_and_capture","mcp__interactive-send-and-capture__capture_pane","mcp__interactive-send-and-capture__send_input","mcp__mcp-mermaid__generate_mermaid_diagram","mcp__brave-search__brave_web_search","mcp__brave-search__brave_local_search","mcp__firecrawl__firecrawl_scrape","mcp__firecrawl__firecrawl_map","mcp__firecrawl__firecrawl_search","mcp__firecrawl__firecrawl_crawl","mcp__firecrawl__firecrawl_check_crawl_status","mcp__firecrawl__firecrawl_extract"],"mcp_servers":[{"name":"fetch","status":"disabled"},{"name":"sequential-thinking","status":"disabled"},{"name":"filesystem","status":"disabled"},{"name":"shadcn-ui","status":"disabled"},{"name":"context7","status":"connected"},{"name":"tmux","status":"connected"},{"name":"serena","status":"disabled"},{"name":"interactive-send-and-capture","status":"connected"},{"name":"mcp-mermaid","status":"connected"},{"name":"chrome-devtools","status":"disabled"},{"name":"svelte","status":"disabled"},{"name":"brave-search","status":"connected"},{"name":"firecrawl","status":"connected"}],"model":"claude-opus-4-5-20251101","permissionMode":"acceptEdits","slash_commands":["claude-code-hook-builder","mermaid-diagram-writer","slash-command-builder","superpowers:brainstorm","superpowers:execute-plan","superpowers:write-plan","agent-sdk-dev:new-sdk-app","pr-review-toolkit:review-pr","commit-commands:clean_gone","commit-commands:commit-push-pr","commit-commands:commit","feature-dev:feature-dev","code-review:code-review","document-skills:xlsx","document-skills:docx","document-skills:pptx","document-skills:pdf","example-skills:skill-creator","example-skills:mcp-builder","example-skills:canvas-design","example-skills:algorithmic-art","example-skills:internal-comms","example-skills:webapp-testing","example-skills:artifacts-builder","example-skills:slack-gif-creator","example-skills:theme-factory","example-skills:brand-guidelines","superpowers:brainstorming","superpowers:condition-based-waiting","superpowers:defense-in-depth","superpowers:dispatching-parallel-agents","superpowers:executing-plans","superpowers:finishing-a-development-branch","superpowers:receiving-code-review","superpowers:requesting-code-review","superpowers:root-cause-tracing","superpowers:sharing-skills","superpowers:subagent-driven-development","superpowers:systematic-debugging","superpowers:test-driven-development","superpowers:testing-anti-patterns","superpowers:testing-skills-with-subagents","superpowers:using-git-worktrees","superpowers:using-superpowers","superpowers:verification-before-completion","superpowers:writing-plans","superpowers:writing-skills","developer-essentials:auth-implementation-patterns","developer-essentials:code-review-excellence","developer-essentials:debugging-strategies","developer-essentials:e2e-testing-patterns","developer-essentials:error-handling-patterns","developer-essentials:git-advanced-workflows","developer-essentials:monorepo-management","developer-essentials:sql-optimization-patterns","developer-essentials:git-advanced-workflows","developer-essentials:sql-optimization-patterns","developer-essentials:error-handling-patterns","developer-essentials:code-review-excellence","developer-essentials:e2e-testing-patterns","developer-essentials:auth-implementation-patterns","developer-essentials:debugging-strategies","developer-essentials:monorepo-management","compact","context","cost","init","pr-comments","release-notes","todos","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.55","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","superpowers:code-reviewer","agent-sdk-dev:agent-sdk-verifier-py","agent-sdk-dev:agent-sdk-verifier-ts","pr-review-toolkit:code-reviewer","pr-review-toolkit:code-simplifier","pr-review-toolkit:comment-analyzer","pr-review-toolkit:pr-test-analyzer","pr-review-toolkit:silent-failure-hunter","pr-review-toolkit:type-design-analyzer","feature-dev:code-architect","feature-dev:code-explorer","feature-dev:code-reviewer"],"skills":["claude-code-hook-builder","mermaid-diagram-writer","slash-command-builder","document-skills:xlsx","document-skills:docx","document-skills:pptx","document-skills:pdf","example-skills:skill-creator","example-skills:mcp-builder","example-skills:canvas-design","example-skills:algorithmic-art","example-skills:internal-comms","example-skills:webapp-testing","example-skills:artifacts-builder","example-skills:slack-gif-creator","example-skills:theme-factory","example-skills:brand-guidelines","superpowers:brainstorming","superpowers:condition-based-waiting","superpowers:defense-in-depth","superpowers:dispatching-parallel-agents","superpowers:executing-plans","superpowers:finishing-a-development-branch","superpowers:receiving-code-review","superpowers:requesting-code-review","superpowers:root-cause-tracing","superpowers:sharing-skills","superpowers:subagent-driven-development","superpowers:systematic-debugging","superpowers:test-driven-development","superpowers:testing-anti-patterns","superpowers:testing-skills-with-subagents","superpowers:using-git-worktrees","superpowers:using-superpowers","superpowers:verification-before-completion","superpowers:writing-plans","superpowers:writing-skills","developer-essentials:auth-implementation-patterns","developer-essentials:code-review-excellence","developer-essentials:debugging-strategies","developer-essentials:e2e-testing-patterns","developer-essentials:error-handling-patterns","developer-essentials:git-advanced-workflows","developer-essentials:monorepo-management","developer-essentials:sql-optimization-patterns","developer-essentials:git-advanced-workflows","developer-essentials:sql-optimization-patterns","developer-essentials:error-handling-patterns","developer-essentials:code-review-excellence","developer-essentials:e2e-testing-patterns","developer-essentials:auth-implementation-patterns","developer-essentials:debugging-strategies","developer-essentials:monorepo-management"],"plugins":[{"name":"document-skills","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/anthropic-agent-skills/"},{"name":"example-skills","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/anthropic-agent-skills/"},{"name":"superpowers","path":"/Users/johnzealand-doyle/.claude/plugins/cache/superpowers"},{"name":"agent-sdk-dev","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/agent-sdk-dev"},{"name":"pr-review-toolkit","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/pr-review-toolkit"},{"name":"commit-commands","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/commit-commands"},{"name":"feature-dev","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/feature-dev"},{"name":"security-guidance","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/security-guidance"},{"name":"code-review","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/code-review"},{"name":"developer-essentials","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-workflows/plugins/developer-essentials"},{"name":"explanatory-output-style","path":"/Users/johnzealand-doyle/.claude/plugins/marketplaces/claude-code-plugins/plugins/explanatory-output-style"}],"uuid":"c9090bc8-1f36-4f11-bfba-dd1e6d49ebb0"},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WjFHNnqMg2om2Asj24j6zq","type":"message","role":"assistant","content":[{"type":"text","text":"I'll start by reading the source document to understand its current structure and content."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":35646,"cache_read_input_tokens":29808,"cache_creation":{"ephemeral_5m_input_tokens":35646,"ephemeral_1h_input_tokens":0},"output_tokens":126,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"ceaa88ce-c462-4af0-bb35-468b4086b5d4"},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WjFHNnqMg2om2Asj24j6zq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015CgzvyDywiJS6m82KEfdvp","name":"Read","input":{"file_path":"/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/markdown/merged_with_pdf_content/FF7_Battle_Battle_Scenes_Battle_Script.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":35646,"cache_read_input_tokens":29808,"cache_creation":{"ephemeral_5m_input_tokens":35646,"ephemeral_1h_input_tokens":0},"output_tokens":126,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"7dd80506-24c2-4e66-96bf-f2deb233ab62"},{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015CgzvyDywiJS6m82KEfdvp","type":"tool_result","content":"     1â†’<!--\n     2â†’MERGE METADATA\n     3â†’Created: 2025-11-29\n     4â†’Original: FF7_Battle_Battle_Scenes_Battle_Script.md (     421 lines)\n     5â†’Major section: 06_BATTLE_MODULE.md\n     6â†’Merge decision: NO EXTRACTION PERFORMED\n     7â†’Reason: Individual file contains comprehensive battle script opcode documentation\n     8â†’Status: COMPLETE - Original file copied as source of truth\n     9â†’-->\n    10â†’\n    11â†’# FF7/Battle/Battle Scenes/Battle Script {#ff7battlebattle_scenesbattle_script}\n    12â†’\n    13â†’- [FF7/Battle/Battle Scenes/Battle Script](#ff7battlebattle_scenesbattle_script){#toc-ff7battlebattle_scenesbattle_script}\n    14â†’\n    15â†’\n    16â†’\n    17â†’(Information on opcodes provided by Terence Fergusson. Almost all information comes from [this post](http://forums.qhimm.com/index.php?topic=3290.msg45951#msg45951) on the forums.)\n    18â†’\n    19â†’There are four actions to be explained when dealing with any opcode in AI script: Arguments, Values to take from the stack, what to do with Arguments and Values, and what to put back on the stack. So to fully understand what is happening a brief explanation of the stack is necessary.\n    20â†’\n    21â†’The stack is more-or-less a list of values with different lengths. Only the top of the stack (the most recently added value) can be accessed at any given time, but when that value is accessed it is removed from the top of the stack and the previously added value now becomes the top of the stack. Adding to the stack is called \\\"Pushing\\\" a value and taking a value off is called \\\"Popping\\\". When pushing a value to the stack, the value of the number is pushed followed by the value type. The value type can be one of three different things:\\\n    22â†’\\\n    23â†’{\\| border=\\\"1\\\" cellspacing=\\\"1\\\" cellpadding=\\\"3\\\" align=\\\"center\\\" style=\\\"border: 1px grey; border-collapse: collapse;\\\"\n    24â†’! style=\\\"background:rgb(104,104,104)\\\" align=\\\"center\\\" \\| Code\n    25â†’! style=\\\"background:rgb(104,104,104)\\\" align=\\\"center\\\" \\| Type\n    26â†’\\|-\n    27â†’\\| align=\\\"center\\\" \\| 0Xh\n    28â†’\\| Value\n    29â†’\\|-\n    30â†’\\| align=\\\"center\\\" \\| 1Xh\n    31â†’\\| [Address](FF7/Battle/Battle_Scenes/Battle_AI_Addresses \"Address\"){.wikilink}\n    32â†’\\|-\n    33â†’\\| align=\\\"center\\\" \\| 2Xh\n    34â†’\\| Multiple (between 1-10) Values\n    35â†’\\|-\n    36â†’\\|}\\\n    37â†’They are stored as DWords, but the X will determine how many bytes to use: 0 = bit, 1 = Byte, 2 = Word, 3 = Three bytes\n    38â†’\n    39â†’Now that we\\'ve seen the stack, here are the opcodes:\n    40â†’\n    41â†’<table>\n    42â†’<thead>\n    43â†’<tr>\n    44â†’<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Code</p></th>\n    45â†’<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Arguments</p></th>\n    46â†’<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value(s) to pop</p></th>\n    47â†’<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value to push</p></th>\n    48â†’</tr>\n    49â†’</thead>\n    50â†’<tbody>\n    51â†’<tr>\n    52â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Values</p></td>\n    53â†’</tr>\n    54â†’<tr>\n    55â†’<td style=\"text-align: center;\"><p>0Xh</p></td>\n    56â†’<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n    57â†’<td style=\"text-align: center;\"></td>\n    58â†’<td style=\"text-align: center;\"><p>Type 0X stored at translated Address</p></td>\n    59â†’</tr>\n    60â†’<tr>\n    61â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Addresses</p></td>\n    62â†’</tr>\n    63â†’<tr>\n    64â†’<td style=\"text-align: center;\"><p>1Xh</p></td>\n    65â†’<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n    66â†’<td style=\"text-align: center;\"></td>\n    67â†’<td style=\"text-align: center;\"><p>Address value with a scope of X</p></td>\n    68â†’</tr>\n    69â†’<tr>\n    70â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Mathematical and Bit-wise Operators</p></td>\n    71â†’</tr>\n    72â†’<tr>\n    73â†’<td style=\"text-align: center;\"><p>30h</p></td>\n    74â†’<td style=\"text-align: center;\"></td>\n    75â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n    76â†’<td style=\"text-align: center;\"><p>Sum of pops</p></td>\n    77â†’</tr>\n    78â†’<tr>\n    79â†’<td style=\"text-align: center;\"><p>31h</p></td>\n    80â†’<td style=\"text-align: center;\"></td>\n    81â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n    82â†’<td style=\"text-align: center;\"><p>Difference of pops</p></td>\n    83â†’</tr>\n    84â†’<tr>\n    85â†’<td style=\"text-align: center;\"><p>32h</p></td>\n    86â†’<td style=\"text-align: center;\"></td>\n    87â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n    88â†’<td style=\"text-align: center;\"><p>Product of pops</p></td>\n    89â†’</tr>\n    90â†’<tr>\n    91â†’<td style=\"text-align: center;\"><p>33h</p></td>\n    92â†’<td style=\"text-align: center;\"></td>\n    93â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n    94â†’<td style=\"text-align: center;\"><p>Quotient of pops</p></td>\n    95â†’</tr>\n    96â†’<tr>\n    97â†’<td style=\"text-align: center;\"><p>34h</p></td>\n    98â†’<td style=\"text-align: center;\"></td>\n    99â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   100â†’<td style=\"text-align: center;\"><p>Remainder from quotient of pops</p></td>\n   101â†’</tr>\n   102â†’<tr>\n   103â†’<td style=\"text-align: center;\"><p>35h</p></td>\n   104â†’<td style=\"text-align: center;\"></td>\n   105â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   106â†’<td style=\"text-align: center;\"><p>Bit-wise AND of pops</p></td>\n   107â†’</tr>\n   108â†’<tr>\n   109â†’<td style=\"text-align: center;\"><p>36h</p></td>\n   110â†’<td style=\"text-align: center;\"></td>\n   111â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   112â†’<td style=\"text-align: center;\"><p>Bit-wise OR of pops</p></td>\n   113â†’</tr>\n   114â†’<tr>\n   115â†’<td style=\"text-align: center;\"><p>37h</p></td>\n   116â†’<td style=\"text-align: center;\"></td>\n   117â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   118â†’<td style=\"text-align: center;\"><p>Bit-wise NOT of pop</p></td>\n   119â†’</tr>\n   120â†’<tr>\n   121â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Operators</p></td>\n   122â†’</tr>\n   123â†’<tr>\n   124â†’<td style=\"text-align: center;\"><p>40h</p></td>\n   125â†’<td style=\"text-align: center;\"></td>\n   126â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   127â†’<td style=\"text-align: center;\"><p>True if pops are EQUAL</p></td>\n   128â†’</tr>\n   129â†’<tr>\n   130â†’<td style=\"text-align: center;\"><p>41h</p></td>\n   131â†’<td style=\"text-align: center;\"></td>\n   132â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   133â†’<td style=\"text-align: center;\"><p>True if pops are NOT EQUAL</p></td>\n   134â†’</tr>\n   135â†’<tr>\n   136â†’<td style=\"text-align: center;\"><p>42h</p></td>\n   137â†’<td style=\"text-align: center;\"></td>\n   138â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   139â†’<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN OR EQUAL TO second pop</p></td>\n   140â†’</tr>\n   141â†’<tr>\n   142â†’<td style=\"text-align: center;\"><p>43h</p></td>\n   143â†’<td style=\"text-align: center;\"></td>\n   144â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   145â†’<td style=\"text-align: center;\"><p>True if first pop is LESS THAN OR EQUAL TO second pop</p></td>\n   146â†’</tr>\n   147â†’<tr>\n   148â†’<td style=\"text-align: center;\"><p>44h</p></td>\n   149â†’<td style=\"text-align: center;\"></td>\n   150â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   151â†’<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN second pop</p></td>\n   152â†’</tr>\n   153â†’<tr>\n   154â†’<td style=\"text-align: center;\"><p>45h</p></td>\n   155â†’<td style=\"text-align: center;\"></td>\n   156â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   157â†’<td style=\"text-align: center;\"><p>True if first pop is LESS THAN second pop</p></td>\n   158â†’</tr>\n   159â†’<tr>\n   160â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Comparisons</p></td>\n   161â†’</tr>\n   162â†’<tr>\n   163â†’<td style=\"text-align: center;\"><p>50h</p></td>\n   164â†’<td style=\"text-align: center;\"></td>\n   165â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   166â†’<td style=\"text-align: center;\"><p>True if both pops are NON-ZERO (Logical AND)</p></td>\n   167â†’</tr>\n   168â†’<tr>\n   169â†’<td style=\"text-align: center;\"><p>51h</p></td>\n   170â†’<td style=\"text-align: center;\"></td>\n   171â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   172â†’<td style=\"text-align: center;\"><p>True if either pop is NON-ZERO (Logical OR)</p></td>\n   173â†’</tr>\n   174â†’<tr>\n   175â†’<td style=\"text-align: center;\"><p>52h</p></td>\n   176â†’<td style=\"text-align: center;\"></td>\n   177â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   178â†’<td style=\"text-align: center;\"><p>True if pop is ZERO (Logical NOT)</p></td>\n   179â†’</tr>\n   180â†’<tr>\n   181â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Constants</p></td>\n   182â†’</tr>\n   183â†’<tr>\n   184â†’<td style=\"text-align: center;\"><p>60h</p></td>\n   185â†’<td style=\"text-align: center;\"><p>1 byte Value</p></td>\n   186â†’<td style=\"text-align: center;\"></td>\n   187â†’<td style=\"text-align: center;\"><p>Argument of type 01</p></td>\n   188â†’</tr>\n   189â†’<tr>\n   190â†’<td style=\"text-align: center;\"><p>61h</p></td>\n   191â†’<td style=\"text-align: center;\"><p>2 byte Value</p></td>\n   192â†’<td style=\"text-align: center;\"></td>\n   193â†’<td style=\"text-align: center;\"><p>Argument of type 02</p></td>\n   194â†’</tr>\n   195â†’<tr>\n   196â†’<td style=\"text-align: center;\"><p>62h</p></td>\n   197â†’<td style=\"text-align: center;\"><p>3 byte Value</p></td>\n   198â†’<td style=\"text-align: center;\"></td>\n   199â†’<td style=\"text-align: center;\"><p>Argument of type 03</p></td>\n   200â†’</tr>\n   201â†’<tr>\n   202â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Script Jumps (No Pushes)</p></td>\n   203â†’</tr>\n   204â†’<tr>\n   205â†’<td style=\"text-align: center;\"><p>70h</p></td>\n   206â†’<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n   207â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   208â†’<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop is 0</p></td>\n   209â†’</tr>\n   210â†’<tr>\n   211â†’<td style=\"text-align: center;\"><p>71h</p></td>\n   212â†’<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n   213â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   214â†’<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop and top of stack are not equal</p></td>\n   215â†’</tr>\n   216â†’<tr>\n   217â†’<td style=\"text-align: center;\"><p>72h</p></td>\n   218â†’<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n   219â†’<td style=\"text-align: center;\"></td>\n   220â†’<td style=\"text-align: center;\"><p>Jumps to script address in argument</p></td>\n   221â†’</tr>\n   222â†’<tr>\n   223â†’<td style=\"text-align: center;\"><p>73h</p></td>\n   224â†’<td colspan=\"3\" style=\"text-align: center;\"><p>This ends the script</p></td>\n   225â†’</tr>\n   226â†’<tr>\n   227â†’<td style=\"text-align: center;\"><p>74h</p></td>\n   228â†’<td style=\"text-align: center;\"></td>\n   229â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   230â†’<td style=\"text-align: center;\"><p>Pops one value from stack. (Not used)</p></td>\n   231â†’</tr>\n   232â†’<tr>\n   233â†’<td style=\"text-align: center;\"><p>75h</p></td>\n   234â†’<td style=\"text-align: center;\"></td>\n   235â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   236â†’<td style=\"text-align: center;\"><p>Link all scripts of script owner to popped Character ID.</p></td>\n   237â†’</tr>\n   238â†’<tr>\n   239â†’<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Bit Operations</p></td>\n   240â†’</tr>\n   241â†’<tr>\n   242â†’<td style=\"text-align: center;\"><p>80h</p></td>\n   243â†’<td style=\"text-align: center;\"></td>\n   244â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   245â†’<td style=\"text-align: center;\"><p>First pop masked by second pop</p></td>\n   246â†’</tr>\n   247â†’<tr>\n   248â†’<td style=\"text-align: center;\"><p>81h</p></td>\n   249â†’<td style=\"text-align: center;\"></td>\n   250â†’<td style=\"text-align: center;\"></td>\n   251â†’<td style=\"text-align: center;\"><p>Random Word (0-65535)</p></td>\n   252â†’</tr>\n   253â†’<tr>\n   254â†’<td style=\"text-align: center;\"><p>82h</p></td>\n   255â†’<td style=\"text-align: center;\"></td>\n   256â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   257â†’<td style=\"text-align: center;\"><p>Random bit of pop stored as type 02</p></td>\n   258â†’</tr>\n   259â†’<tr>\n   260â†’<td style=\"text-align: center;\"><p>83h</p></td>\n   261â†’<td style=\"text-align: center;\"></td>\n   262â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   263â†’<td style=\"text-align: center;\"><p>If pop is Type 01, Type 01 with count of number of bits set in pop<br />\n   264â†’If pop is Type 02, Type 02 filled with value of first non-null value in pop</p></td>\n   265â†’</tr>\n   266â†’<tr>\n   267â†’<td style=\"text-align: center;\"><p>84h</p></td>\n   268â†’<td style=\"text-align: center;\"></td>\n   269â†’<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n   270â†’<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were greatest</p></td>\n   271â†’</tr>\n   272â†’<tr>\n   273â†’<td style=\"text-align: center;\"><p>85h</p></td>\n   274â†’<td style=\"text-align: center;\"></td>\n   275â†’<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n   276â†’<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were least</p></td>\n   277â†’</tr>\n   278â†’<tr>\n   279â†’<td style=\"text-align: center;\"><p>86h</p></td>\n   280â†’<td style=\"text-align: center;\"></td>\n   281â†’<td style=\"text-align: center;\"><p>One of type 1X</p></td>\n   282â†’<td style=\"text-align: center;\"><p>Type 02 indicating MP Cost of attack index referenced in pop</p></td>\n   283â†’</tr>\n   284â†’<tr>\n   285â†’<td style=\"text-align: center;\"><p>87h</p></td>\n   286â†’<td style=\"text-align: center;\"></td>\n   287â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   288â†’<td style=\"text-align: center;\"><p>Type 02 with only bit in pop turned on (1 &lt;&lt; [pop])</p></td>\n   289â†’</tr>\n   290â†’<tr>\n   291â†’<td style=\"text-align: center;\"></td>\n   292â†’<td style=\"text-align: center;\"></td>\n   293â†’<td style=\"text-align: center;\"></td>\n   294â†’<td style=\"text-align: center;\"></td>\n   295â†’</tr>\n   296â†’</tbody>\n   297â†’</table>\n   298â†’\n   299â†’Â \n   300â†’\n   301â†’<table>\n   302â†’<thead>\n   303â†’<tr>\n   304â†’<th colspan=\"4\" style=\"text-align: center; background: rgb(104,104,104);\"><p>Command</p></th>\n   305â†’</tr>\n   306â†’</thead>\n   307â†’<tbody>\n   308â†’<tr>\n   309â†’<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Code</p></td>\n   310â†’<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Arguments</p></td>\n   311â†’<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Value(s) to pop</p></td>\n   312â†’<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Effect</p></td>\n   313â†’</tr>\n   314â†’<tr>\n   315â†’<td style=\"text-align: center;\"><p>90h</p></td>\n   316â†’<td style=\"text-align: center;\"></td>\n   317â†’<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X</p></td>\n   318â†’<td style=\"text-align: center;\"><p>If first pop &lt; 4000h; Stores second pop at first pop</p></td>\n   319â†’</tr>\n   320â†’<tr>\n   321â†’<td style=\"text-align: center;\"><p>90h</p></td>\n   322â†’<td style=\"text-align: center;\"></td>\n   323â†’<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X, One of type 1X</p></td>\n   324â†’<td style=\"text-align: center;\"><p>If first pop &gt;= 4000h; Stores second pop at first pop constrained by mask at third pop</p></td>\n   325â†’</tr>\n   326â†’<tr>\n   327â†’<td style=\"text-align: center;\"><p>91h</p></td>\n   328â†’<td style=\"text-align: center;\"></td>\n   329â†’<td style=\"text-align: center;\"><p>One of any type</p></td>\n   330â†’<td style=\"text-align: center;\"><p>Pops one value from stack.</p></td>\n   331â†’</tr>\n   332â†’<tr>\n   333â†’<td style=\"text-align: center;\"><p>92h</p></td>\n   334â†’<td style=\"text-align: center;\"></td>\n   335â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   336â†’<td style=\"text-align: center;\"><p>First pop is attack ID to perform. Second pop action type<br />\n   337â†’</p></td>\n   338â†’</tr>\n   339â†’<tr>\n   340â†’<td style=\"text-align: center;\"><p>93h</p></td>\n   341â†’<td style=\"text-align: center;\"><p>NULL terminated string</p></td>\n   342â†’<td style=\"text-align: center;\"></td>\n   343â†’<td style=\"text-align: center;\"><p>Displays string</p></td>\n   344â†’</tr>\n   345â†’<tr>\n   346â†’<td style=\"text-align: center;\"><p>94h</p></td>\n   347â†’<td style=\"text-align: center;\"></td>\n   348â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   349â†’<td style=\"text-align: center;\"><p>Copy current status, hp and mp as well as some other specific data (like boosts, multipliers) from units in first given mask to units in second mask.</p></td>\n   350â†’</tr>\n   351â†’<tr>\n   352â†’<td style=\"text-align: center;\"><p>95h</p></td>\n   353â†’<td style=\"text-align: center;\"></td>\n   354â†’<td style=\"text-align: center;\"><p>One of type 1X, one of type 00</p></td>\n   355â†’<td style=\"text-align: center;\"><p>If second pop is 1, takes value at local address 2010 and writes value at <a href=\"FF7/Savemap#Save_Memory_Bank_1.2F2\" class=\"wikilink\" title=\"memory bank 1/2\">memory bank 1/2</a> at offset specified by first pop<br />\n   356â†’If second pop is 0, data at memory bank1/2 at offset specified by first pop is stored at local address 2010.<br />\n   357â†’Otherwise, command is ignored.</p></td>\n   358â†’</tr>\n   359â†’<tr>\n   360â†’<td style=\"text-align: center;\"><p>96h</p></td>\n   361â†’<td style=\"text-align: center;\"></td>\n   362â†’<td style=\"text-align: center;\"><p>Two of any type</p></td>\n   363â†’<td style=\"text-align: center;\"><p>Get fighter elemental defense.</p></td>\n   364â†’</tr>\n   365â†’<tr>\n   366â†’<td style=\"text-align: center;\"><p>A0h</p></td>\n   367â†’<td style=\"text-align: center;\"><p>One byte, NULL terminated ASCII</p></td>\n   368â†’<td style=\"text-align: center;\"><p>First argument of any type</p></td>\n   369â†’<td style=\"text-align: center;\"><p>Displays string to debug console, replacing \"%d\"s with pops</p></td>\n   370â†’</tr>\n   371â†’<tr>\n   372â†’<td style=\"text-align: center;\"><p>A1h</p></td>\n   373â†’<td style=\"text-align: center;\"></td>\n   374â†’<td style=\"text-align: center;\"><p>Two values of any type</p></td>\n   375â†’<td style=\"text-align: center;\"><p>Pops two values from stack (Not Used, but valid command)</p></td>\n   376â†’</tr>\n   377â†’<tr>\n   378â†’<td style=\"text-align: center;\"></td>\n   379â†’<td style=\"text-align: center;\"></td>\n   380â†’<td style=\"text-align: center;\"></td>\n   381â†’<td style=\"text-align: center;\"></td>\n   382â†’</tr>\n   383â†’</tbody>\n   384â†’</table>\n   385â†’\n   386â†’\\\n   387â†’GENERAL NOTES:\n   388â†’\n   389â†’- Command 90h is overloaded.\n   390â†’- If a type 2X is popped and any type is accepted, only the first value will be considered.\n   391â†’- If specific type is expected and that type is not available, the game with either crash or ignore that entire line.\n   392â†’- TRUE and FALSE are stored as type 00 as \\'1\\' and \\'0\\' respectively.\n   393â†’- Commands 74h and A1h are never used, but have been documented as valid commands.\n   394â†’- Commands 75h and 96h only appear in the Character AI found in the KERNEL.BIN.\n   395â†’- Commands of group 2X, BX, CX, DX, EX, and FX are treated as NOPs. The script will ignore them and continue processing. Also, any 5X, 6X, 7X, 8X, and 9X value that isn\\'t listed above appear to be treated the same way, but it\\'s safest to use a value from the 2X group. An incorrect 0X, 1X, 3X, or 4X will have unintended side-effects.\n   396â†’\n   397â†’0X & 1X CODES NOTES:\n   398â†’\n   399â†’- Valid values for X are 0, 1, 2, and 3.\n   400â†’  - These will store a bit, byte, word, and dword respectively.\n   401â†’\n   402â†’3X CODES NOTES:\n   403â†’\n   404â†’- The pushed value is type 2x if either of the pops are a 1X or 2X. In that case, the Masks of both pops are ANDed together. In \\*all\\* cases, the highest pop\\'s size is used to determine the new pop\\'s size.\n   405â†’\n   406â†’4X CODES NOTES:\n   407â†’\n   408â†’- The Pushed value will be type 00 if either component is a 1X or 2X type. It will only push TRUE or FALSE\n   409â†’- If both were 0X types, the result will be a type 02 which contains the Mask of all the objects in the pops that passed the comparison\n   410â†’\n   411â†’86 CODE NOTES:\n   412â†’\n   413â†’- This get the MP Cost of the ability referenced in the pop. The value of pop is referenced to the following areas:\n   414â†’\n   415â†’`Â IfÂ ValueÂ >=Â 0xFFFF,Â returnÂ 0`\\\n   416â†’`Â IfÂ ValueÂ <=Â 0x00FF,Â AddrÂ =Â 00DAAC78Â +Â Value*0x1C`\\\n   417â†’`Â IfÂ ValueÂ >=Â 0x0100,Â matchÂ ValueÂ withÂ wr[0099AAF4+(ID=[0..31])*2]`\\\n   418â†’`Â Â Â Â FirstÂ IDÂ itÂ matches,Â AddrÂ =Â 0099A774Â +Â ID*0x1C`\\\n   419â†’`Â IfÂ noÂ AddrÂ isÂ found,Â returnÂ 0`\\\n   420â†’`Â Otherwise,Â returnÂ wr[AddrÂ +Â 4]`\n   421â†’\n   422â†’The pushed value is, thus, the MP cost of the defined ability as a type 02. Note that 0x00 to 0xFF are standard magic and always loaded, while 0x100+ are the unique abilities loaded through scene.bin.\n   423â†’\n   424â†’92 CODE NOTES:\n   425â†’\n   426â†’- Second pop must be one of the following:\n   427â†’\n   428â†’:   [Command index](FF7/Command_data \"Command index\"){.wikilink} in case of character AI\n   429â†’:   20h - For enemy attack\n   430â†’:   22h - Force execution of script (referenced by first pop)\n   431â†’:   24h - Pauses battle engine while string is displayed (in conjunction with code 93)\n   432â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"ee3bee5c-d666-4258-909d-80a34050beda","tool_use_result":{"type":"text","file":{"filePath":"/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/markdown/merged_with_pdf_content/FF7_Battle_Battle_Scenes_Battle_Script.md","content":"<!--\nMERGE METADATA\nCreated: 2025-11-29\nOriginal: FF7_Battle_Battle_Scenes_Battle_Script.md (     421 lines)\nMajor section: 06_BATTLE_MODULE.md\nMerge decision: NO EXTRACTION PERFORMED\nReason: Individual file contains comprehensive battle script opcode documentation\nStatus: COMPLETE - Original file copied as source of truth\n-->\n\n# FF7/Battle/Battle Scenes/Battle Script {#ff7battlebattle_scenesbattle_script}\n\n- [FF7/Battle/Battle Scenes/Battle Script](#ff7battlebattle_scenesbattle_script){#toc-ff7battlebattle_scenesbattle_script}\n\n\n\n(Information on opcodes provided by Terence Fergusson. Almost all information comes from [this post](http://forums.qhimm.com/index.php?topic=3290.msg45951#msg45951) on the forums.)\n\nThere are four actions to be explained when dealing with any opcode in AI script: Arguments, Values to take from the stack, what to do with Arguments and Values, and what to put back on the stack. So to fully understand what is happening a brief explanation of the stack is necessary.\n\nThe stack is more-or-less a list of values with different lengths. Only the top of the stack (the most recently added value) can be accessed at any given time, but when that value is accessed it is removed from the top of the stack and the previously added value now becomes the top of the stack. Adding to the stack is called \\\"Pushing\\\" a value and taking a value off is called \\\"Popping\\\". When pushing a value to the stack, the value of the number is pushed followed by the value type. The value type can be one of three different things:\\\n\\\n{\\| border=\\\"1\\\" cellspacing=\\\"1\\\" cellpadding=\\\"3\\\" align=\\\"center\\\" style=\\\"border: 1px grey; border-collapse: collapse;\\\"\n! style=\\\"background:rgb(104,104,104)\\\" align=\\\"center\\\" \\| Code\n! style=\\\"background:rgb(104,104,104)\\\" align=\\\"center\\\" \\| Type\n\\|-\n\\| align=\\\"center\\\" \\| 0Xh\n\\| Value\n\\|-\n\\| align=\\\"center\\\" \\| 1Xh\n\\| [Address](FF7/Battle/Battle_Scenes/Battle_AI_Addresses \"Address\"){.wikilink}\n\\|-\n\\| align=\\\"center\\\" \\| 2Xh\n\\| Multiple (between 1-10) Values\n\\|-\n\\|}\\\nThey are stored as DWords, but the X will determine how many bytes to use: 0 = bit, 1 = Byte, 2 = Word, 3 = Three bytes\n\nNow that we\\'ve seen the stack, here are the opcodes:\n\n<table>\n<thead>\n<tr>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Code</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Arguments</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value(s) to pop</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value to push</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Values</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>0Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Type 0X stored at translated Address</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Addresses</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>1Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Address value with a scope of X</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Mathematical and Bit-wise Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>30h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Sum of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>31h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Difference of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>32h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Product of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>33h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>34h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Remainder from quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>35h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise AND of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>36h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise OR of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>37h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise NOT of pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>40h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>41h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are NOT EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>42h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>43h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>44h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>45h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN second pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Comparisons</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>50h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if both pops are NON-ZERO (Logical AND)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>51h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if either pop is NON-ZERO (Logical OR)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>52h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pop is ZERO (Logical NOT)</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Constants</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>60h</p></td>\n<td style=\"text-align: center;\"><p>1 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 01</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>61h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>62h</p></td>\n<td style=\"text-align: center;\"><p>3 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 03</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Script Jumps (No Pushes)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>70h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop is 0</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>71h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop and top of stack are not equal</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>72h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>73h</p></td>\n<td colspan=\"3\" style=\"text-align: center;\"><p>This ends the script</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>74h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack. (Not used)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>75h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Link all scripts of script owner to popped Character ID.</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Bit Operations</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>80h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop masked by second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>81h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Random Word (0-65535)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>82h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Random bit of pop stored as type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>83h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>If pop is Type 01, Type 01 with count of number of bits set in pop<br />\nIf pop is Type 02, Type 02 filled with value of first non-null value in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>84h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were greatest</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>85h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were least</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>86h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating MP Cost of attack index referenced in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>87h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Type 02 with only bit in pop turned on (1 &lt;&lt; [pop])</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n\nÂ \n\n<table>\n<thead>\n<tr>\n<th colspan=\"4\" style=\"text-align: center; background: rgb(104,104,104);\"><p>Command</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Code</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Arguments</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Value(s) to pop</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Effect</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &lt; 4000h; Stores second pop at first pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X, One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &gt;= 4000h; Stores second pop at first pop constrained by mask at third pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>91h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>92h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop is attack ID to perform. Second pop action type<br />\n</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>93h</p></td>\n<td style=\"text-align: center;\"><p>NULL terminated string</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Displays string</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>94h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Copy current status, hp and mp as well as some other specific data (like boosts, multipliers) from units in first given mask to units in second mask.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>95h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, one of type 00</p></td>\n<td style=\"text-align: center;\"><p>If second pop is 1, takes value at local address 2010 and writes value at <a href=\"FF7/Savemap#Save_Memory_Bank_1.2F2\" class=\"wikilink\" title=\"memory bank 1/2\">memory bank 1/2</a> at offset specified by first pop<br />\nIf second pop is 0, data at memory bank1/2 at offset specified by first pop is stored at local address 2010.<br />\nOtherwise, command is ignored.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>96h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Get fighter elemental defense.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A0h</p></td>\n<td style=\"text-align: center;\"><p>One byte, NULL terminated ASCII</p></td>\n<td style=\"text-align: center;\"><p>First argument of any type</p></td>\n<td style=\"text-align: center;\"><p>Displays string to debug console, replacing \"%d\"s with pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A1h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two values of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops two values from stack (Not Used, but valid command)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n</tr>\n</tbody>\n</table>\n\n\\\nGENERAL NOTES:\n\n- Command 90h is overloaded.\n- If a type 2X is popped and any type is accepted, only the first value will be considered.\n- If specific type is expected and that type is not available, the game with either crash or ignore that entire line.\n- TRUE and FALSE are stored as type 00 as \\'1\\' and \\'0\\' respectively.\n- Commands 74h and A1h are never used, but have been documented as valid commands.\n- Commands 75h and 96h only appear in the Character AI found in the KERNEL.BIN.\n- Commands of group 2X, BX, CX, DX, EX, and FX are treated as NOPs. The script will ignore them and continue processing. Also, any 5X, 6X, 7X, 8X, and 9X value that isn\\'t listed above appear to be treated the same way, but it\\'s safest to use a value from the 2X group. An incorrect 0X, 1X, 3X, or 4X will have unintended side-effects.\n\n0X & 1X CODES NOTES:\n\n- Valid values for X are 0, 1, 2, and 3.\n  - These will store a bit, byte, word, and dword respectively.\n\n3X CODES NOTES:\n\n- The pushed value is type 2x if either of the pops are a 1X or 2X. In that case, the Masks of both pops are ANDed together. In \\*all\\* cases, the highest pop\\'s size is used to determine the new pop\\'s size.\n\n4X CODES NOTES:\n\n- The Pushed value will be type 00 if either component is a 1X or 2X type. It will only push TRUE or FALSE\n- If both were 0X types, the result will be a type 02 which contains the Mask of all the objects in the pops that passed the comparison\n\n86 CODE NOTES:\n\n- This get the MP Cost of the ability referenced in the pop. The value of pop is referenced to the following areas:\n\n`Â IfÂ ValueÂ >=Â 0xFFFF,Â returnÂ 0`\\\n`Â IfÂ ValueÂ <=Â 0x00FF,Â AddrÂ =Â 00DAAC78Â +Â Value*0x1C`\\\n`Â IfÂ ValueÂ >=Â 0x0100,Â matchÂ ValueÂ withÂ wr[0099AAF4+(ID=[0..31])*2]`\\\n`Â Â Â Â FirstÂ IDÂ itÂ matches,Â AddrÂ =Â 0099A774Â +Â ID*0x1C`\\\n`Â IfÂ noÂ AddrÂ isÂ found,Â returnÂ 0`\\\n`Â Otherwise,Â returnÂ wr[AddrÂ +Â 4]`\n\nThe pushed value is, thus, the MP cost of the defined ability as a type 02. Note that 0x00 to 0xFF are standard magic and always loaded, while 0x100+ are the unique abilities loaded through scene.bin.\n\n92 CODE NOTES:\n\n- Second pop must be one of the following:\n\n:   [Command index](FF7/Command_data \"Command index\"){.wikilink} in case of character AI\n:   20h - For enemy attack\n:   22h - Force execution of script (referenced by first pop)\n:   24h - Pauses battle engine while string is displayed (in conjunction with code 93)\n","numLines":432,"startLine":1,"totalLines":432}}},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VoizfUxwPHAmqxvsoxTT84","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a complete view of the document. Let me also check the final output directory to ensure it exists:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":8421,"cache_read_input_tokens":65454,"cache_creation":{"ephemeral_5m_input_tokens":8421,"ephemeral_1h_input_tokens":0},"output_tokens":148,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"4dbd2852-3422-49ef-ae1e-634a4af90561"},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VoizfUxwPHAmqxvsoxTT84","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WpPQBMD6E1AVAnAEjUMgBK","name":"Bash","input":{"command":"ls -la /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/ 2>/dev/null || echo \"Directory does not exist\"","description":"Check if final output directory exists"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":8421,"cache_read_input_tokens":65454,"cache_creation":{"ephemeral_5m_input_tokens":8421,"ephemeral_1h_input_tokens":0},"output_tokens":148,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"c3b8f430-36be-49d9-869c-ff0ae8e189d9"},{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WpPQBMD6E1AVAnAEjUMgBK","type":"tool_result","content":"total 280\ndrwxr-xr-x@  5 johnzealand-doyle  staff    160 Dec  1 23:00 .\ndrwxr-xr-x@ 80 johnzealand-doyle  staff   2560 Dec  1 20:15 ..\n-rw-------@  1 johnzealand-doyle  staff  33803 Dec  1 22:49 FF7_Battle_Battle_Animation_PC.md\n-rw-------@  1 johnzealand-doyle  staff   5910 Dec  1 22:51 FF7_Battle_Battle_Field.md\n-rw-------@  1 johnzealand-doyle  staff  97491 Dec  1 23:00 FF7_Battle_Battle_Mechanics.md","is_error":false}]},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"74b4167a-76b2-473f-85dc-a1806e087ecd","tool_use_result":{"stdout":"total 280\ndrwxr-xr-x@  5 johnzealand-doyle  staff    160 Dec  1 23:00 .\ndrwxr-xr-x@ 80 johnzealand-doyle  staff   2560 Dec  1 20:15 ..\n-rw-------@  1 johnzealand-doyle  staff  33803 Dec  1 22:49 FF7_Battle_Battle_Animation_PC.md\n-rw-------@  1 johnzealand-doyle  staff   5910 Dec  1 22:51 FF7_Battle_Battle_Field.md\n-rw-------@  1 johnzealand-doyle  staff  97491 Dec  1 23:00 FF7_Battle_Battle_Mechanics.md","stderr":"","interrupted":false,"isImage":false}},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_012aTek5dwek9Qcovcqjgxrp","type":"message","role":"assistant","content":[{"type":"text","text":"Good, the directory exists. Now let me analyze the document structure and create the standardized version:\n\n`â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`\n**Document Analysis:**\n1. This is a Battle Script opcode reference - essentially a bytecode specification for FF7's AI scripting system\n2. The document has NO heading hierarchy beyond H1 - all content is flat under a single title\n3. Contains complex HTML tables that should be preserved (they have colspan/rowspan styling)\n4. Wiki-style links exist (e.g., `{.wikilink}`) that need conversion\n5. The stack-based VM architecture is the core concept for LLM routing\n`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":357,"cache_read_input_tokens":73875,"cache_creation":{"ephemeral_5m_input_tokens":357,"ephemeral_1h_input_tokens":0},"output_tokens":7553,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"dc3f4238-e9e4-4eb0-b664-24e7228aa834"},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_012aTek5dwek9Qcovcqjgxrp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012m8pcC591U6UwzQ82Kqdbb","name":"Write","input":{"file_path":"/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md","content":"---\ntitle: \"FF7 Battle Script Opcodes\"\nmodule: \"Battle\"\ncreated: \"2025-11-29 00:00 JST\"\nmodified: \"2025-12-01 23:01 JST\"\nsession_id: \"887a1b3f-e34c-44f4-8434-e7e55610b603\"\nauthor: \"Generated by Claude Code Documentation Standardization Agent\"\nstatus: \"Complete\"\n\n# LLM-specific metadata (CRITICAL for routing)\nllm_summary: \"Comprehensive opcode reference for FF7's stack-based battle AI scripting system, documenting push operations, mathematical/logical operators, script jumps, and command execution. LLMs should read this when analyzing enemy AI behavior, debugging battle scripts, or understanding how attack decisions are made programmatically.\"\nllm_tags: [\"battle-ai\", \"opcodes\", \"stack-machine\", \"scripting\", \"scene-bin\"]\nllm_primary_topics: [\"AI Script Opcodes\", \"Stack Operations\", \"Battle Commands\", \"Script Flow Control\", \"Memory Addressing\"]\nllm_related_docs: [\"FF7_Battle_Battle_Scenes.md\", \"FF7_Battle_Battle_Mechanics.md\", \"FF7_Savemap.md\"]\n\n# Backlinks (leave empty - populated in pass 2)\nreferenced_by: []\n---\n\n<!--\nSTANDARDIZATION METADATA\nOriginal: FF7_Battle_Battle_Scenes_Battle_Script.md\nSource: merged_with_pdf_content/FF7_Battle_Battle_Scenes_Battle_Script.md\nStandardized: 2025-12-01 23:01 JST\nSession-ID: 887a1b3f-e34c-44f4-8434-e7e55610b603\nAgent: FF7 Documentation Standardization Agent v1.0\n\nPrevious Merge Metadata:\nMERGE METADATA\nCreated: 2025-11-29\nOriginal: FF7_Battle_Battle_Scenes_Battle_Script.md (421 lines)\nMajor section: 06_BATTLE_MODULE.md\nMerge decision: NO EXTRACTION PERFORMED\nReason: Individual file contains comprehensive battle script opcode documentation\nStatus: COMPLETE - Original file copied as source of truth\n\nStandardization Changes Applied:\n- Added YAML frontmatter with LLM routing metadata\n- Added HTML comment metadata block with standardization history\n- Fixed heading hierarchy: Added H2 sections to organize flat content (Stack Concepts, Opcode Reference, Command Reference, Technical Notes)\n- Converted 3 wiki-style links to standard markdown format\n- Removed wiki-style anchor syntax from H1 title\n- Added language tags to code block (text for address format examples)\n- Preserved complex HTML tables (colspan/rowspan styling requires HTML)\n- Fixed escaped characters (removed unnecessary backslashes)\n\nLLM CONTEXT BLOCK (Read this first for routing decisions):\nThis document defines the complete bytecode instruction set for FF7's battle AI scripting system.\nThe AI uses a stack-based virtual machine where opcodes push/pop values and perform operations.\nKey concepts: value types (0Xh=value, 1Xh=address, 2Xh=multiple), script flow control, and\ncommand execution (90h-A1h). Cross-reference with Battle_AI_Addresses for memory layout and\nBattle_Scenes for scene.bin context. Essential for modding enemy behavior or understanding\nwhy specific attack patterns occur.\n-->\n\n# FF7 Battle Script Opcodes\n\n## Overview\n\nInformation on opcodes provided by Terence Fergusson. Almost all information comes from [this post](http://forums.qhimm.com/index.php?topic=3290.msg45951#msg45951) on the Qhimm forums.\n\nThere are four actions to be explained when dealing with any opcode in AI script: Arguments, Values to take from the stack, what to do with Arguments and Values, and what to put back on the stack. To fully understand what is happening, a brief explanation of the stack is necessary.\n\n## Stack Concepts\n\nThe stack is more-or-less a list of values with different lengths. Only the top of the stack (the most recently added value) can be accessed at any given time, but when that value is accessed it is removed from the top of the stack and the previously added value now becomes the top of the stack. Adding to the stack is called \"Pushing\" a value and taking a value off is called \"Popping\". When pushing a value to the stack, the value of the number is pushed followed by the value type.\n\n### Value Types\n\nThe value type can be one of three different things:\n\n| Code | Type |\n|:----:|------|\n| 0Xh | Value |\n| 1Xh | [Address](FF7_Battle_Battle_AI_Addresses.md) |\n| 2Xh | Multiple (between 1-10) Values |\n\nThey are stored as DWords, but the X will determine how many bytes to use: 0 = bit, 1 = Byte, 2 = Word, 3 = Three bytes.\n\n## Opcode Reference\n\nNow that we've seen the stack, here are the opcodes:\n\n<table>\n<thead>\n<tr>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Code</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Arguments</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value(s) to pop</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value to push</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Values</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>0Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Type 0X stored at translated Address</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Addresses</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>1Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Address value with a scope of X</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Mathematical and Bit-wise Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>30h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Sum of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>31h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Difference of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>32h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Product of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>33h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>34h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Remainder from quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>35h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise AND of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>36h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise OR of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>37h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise NOT of pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>40h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>41h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are NOT EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>42h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>43h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>44h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>45h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN second pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Comparisons</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>50h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if both pops are NON-ZERO (Logical AND)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>51h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if either pop is NON-ZERO (Logical OR)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>52h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pop is ZERO (Logical NOT)</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Constants</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>60h</p></td>\n<td style=\"text-align: center;\"><p>1 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 01</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>61h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>62h</p></td>\n<td style=\"text-align: center;\"><p>3 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 03</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Script Jumps (No Pushes)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>70h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop is 0</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>71h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop and top of stack are not equal</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>72h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>73h</p></td>\n<td colspan=\"3\" style=\"text-align: center;\"><p>This ends the script</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>74h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack. (Not used)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>75h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Link all scripts of script owner to popped Character ID.</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Bit Operations</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>80h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop masked by second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>81h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Random Word (0-65535)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>82h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Random bit of pop stored as type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>83h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>If pop is Type 01, Type 01 with count of number of bits set in pop<br />\nIf pop is Type 02, Type 02 filled with value of first non-null value in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>84h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were greatest</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>85h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were least</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>86h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating MP Cost of attack index referenced in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>87h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Type 02 with only bit in pop turned on (1 &lt;&lt; [pop])</p></td>\n</tr>\n</tbody>\n</table>\n\n## Command Reference\n\n<table>\n<thead>\n<tr>\n<th colspan=\"4\" style=\"text-align: center; background: rgb(104,104,104);\"><p>Command</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Code</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Arguments</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Value(s) to pop</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Effect</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &lt; 4000h; Stores second pop at first pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X, One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &gt;= 4000h; Stores second pop at first pop constrained by mask at third pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>91h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>92h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop is attack ID to perform. Second pop action type</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>93h</p></td>\n<td style=\"text-align: center;\"><p>NULL terminated string</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Displays string</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>94h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Copy current status, hp and mp as well as some other specific data (like boosts, multipliers) from units in first given mask to units in second mask.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>95h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, one of type 00</p></td>\n<td style=\"text-align: center;\"><p>If second pop is 1, takes value at local address 2010 and writes value at <a href=\"FF7_Savemap.md#save-memory-bank-12\">memory bank 1/2</a> at offset specified by first pop<br />\nIf second pop is 0, data at memory bank1/2 at offset specified by first pop is stored at local address 2010.<br />\nOtherwise, command is ignored.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>96h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Get fighter elemental defense.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A0h</p></td>\n<td style=\"text-align: center;\"><p>One byte, NULL terminated ASCII</p></td>\n<td style=\"text-align: center;\"><p>First argument of any type</p></td>\n<td style=\"text-align: center;\"><p>Displays string to debug console, replacing \"%d\"s with pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A1h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two values of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops two values from stack (Not Used, but valid command)</p></td>\n</tr>\n</tbody>\n</table>\n\n## Technical Notes\n\n### General Notes\n\n- Command 90h is overloaded.\n- If a type 2X is popped and any type is accepted, only the first value will be considered.\n- If specific type is expected and that type is not available, the game will either crash or ignore that entire line.\n- TRUE and FALSE are stored as type 00 as '1' and '0' respectively.\n- Commands 74h and A1h are never used, but have been documented as valid commands.\n- Commands 75h and 96h only appear in the Character AI found in the KERNEL.BIN.\n- Commands of group 2X, BX, CX, DX, EX, and FX are treated as NOPs. The script will ignore them and continue processing. Also, any 5X, 6X, 7X, 8X, and 9X value that isn't listed above appear to be treated the same way, but it's safest to use a value from the 2X group. An incorrect 0X, 1X, 3X, or 4X will have unintended side-effects.\n\n### 0X and 1X Codes Notes\n\n- Valid values for X are 0, 1, 2, and 3.\n  - These will store a bit, byte, word, and dword respectively.\n\n### 3X Codes Notes\n\n- The pushed value is type 2x if either of the pops are a 1X or 2X. In that case, the Masks of both pops are ANDed together. In *all* cases, the highest pop's size is used to determine the new pop's size.\n\n### 4X Codes Notes\n\n- The Pushed value will be type 00 if either component is a 1X or 2X type. It will only push TRUE or FALSE\n- If both were 0X types, the result will be a type 02 which contains the Mask of all the objects in the pops that passed the comparison\n\n### 86h Code Notes\n\nThis gets the MP Cost of the ability referenced in the pop. The value of pop is referenced to the following areas:\n\n```text\nIf Value >= 0xFFFF, return 0\nIf Value <= 0x00FF, Addr = 00DAAC78 + Value*0x1C\nIf Value >= 0x0100, match Value with wr[0099AAF4+(ID=[0..31])*2]\n   First ID it matches, Addr = 0099A774 + ID*0x1C\nIf no Addr is found, return 0\nOtherwise, return wr[Addr + 4]\n```\n\nThe pushed value is, thus, the MP cost of the defined ability as a type 02. Note that 0x00 to 0xFF are standard magic and always loaded, while 0x100+ are the unique abilities loaded through scene.bin.\n\n### 92h Code Notes\n\nSecond pop must be one of the following:\n\n- [Command index](FF7_Kernel.md#section-1-command-data-format) in case of character AI\n- 20h - For enemy attack\n- 22h - Force execution of script (referenced by first pop)\n- 24h - Pauses battle engine while string is displayed (in conjunction with code 93)\n"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":357,"cache_read_input_tokens":73875,"cache_creation":{"ephemeral_5m_input_tokens":357,"ephemeral_1h_input_tokens":0},"output_tokens":7553,"service_tier":"standard"},"context_management":{"applied_edits":[]}},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"6b25bd8e-c5d0-4b2f-8d1e-951948aa72e3"},{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012m8pcC591U6UwzQ82Kqdbb","type":"tool_result","content":"File created successfully at: /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md"}]},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"104be8eb-1d7f-4165-8ac1-dcc71806a6c3","tool_use_result":{"type":"create","filePath":"/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md","content":"---\ntitle: \"FF7 Battle Script Opcodes\"\nmodule: \"Battle\"\ncreated: \"2025-11-29 00:00 JST\"\nmodified: \"2025-12-01 23:01 JST\"\nsession_id: \"887a1b3f-e34c-44f4-8434-e7e55610b603\"\nauthor: \"Generated by Claude Code Documentation Standardization Agent\"\nstatus: \"Complete\"\n\n# LLM-specific metadata (CRITICAL for routing)\nllm_summary: \"Comprehensive opcode reference for FF7's stack-based battle AI scripting system, documenting push operations, mathematical/logical operators, script jumps, and command execution. LLMs should read this when analyzing enemy AI behavior, debugging battle scripts, or understanding how attack decisions are made programmatically.\"\nllm_tags: [\"battle-ai\", \"opcodes\", \"stack-machine\", \"scripting\", \"scene-bin\"]\nllm_primary_topics: [\"AI Script Opcodes\", \"Stack Operations\", \"Battle Commands\", \"Script Flow Control\", \"Memory Addressing\"]\nllm_related_docs: [\"FF7_Battle_Battle_Scenes.md\", \"FF7_Battle_Battle_Mechanics.md\", \"FF7_Savemap.md\"]\n\n# Backlinks (leave empty - populated in pass 2)\nreferenced_by: []\n---\n\n<!--\nSTANDARDIZATION METADATA\nOriginal: FF7_Battle_Battle_Scenes_Battle_Script.md\nSource: merged_with_pdf_content/FF7_Battle_Battle_Scenes_Battle_Script.md\nStandardized: 2025-12-01 23:01 JST\nSession-ID: 887a1b3f-e34c-44f4-8434-e7e55610b603\nAgent: FF7 Documentation Standardization Agent v1.0\n\nPrevious Merge Metadata:\nMERGE METADATA\nCreated: 2025-11-29\nOriginal: FF7_Battle_Battle_Scenes_Battle_Script.md (421 lines)\nMajor section: 06_BATTLE_MODULE.md\nMerge decision: NO EXTRACTION PERFORMED\nReason: Individual file contains comprehensive battle script opcode documentation\nStatus: COMPLETE - Original file copied as source of truth\n\nStandardization Changes Applied:\n- Added YAML frontmatter with LLM routing metadata\n- Added HTML comment metadata block with standardization history\n- Fixed heading hierarchy: Added H2 sections to organize flat content (Stack Concepts, Opcode Reference, Command Reference, Technical Notes)\n- Converted 3 wiki-style links to standard markdown format\n- Removed wiki-style anchor syntax from H1 title\n- Added language tags to code block (text for address format examples)\n- Preserved complex HTML tables (colspan/rowspan styling requires HTML)\n- Fixed escaped characters (removed unnecessary backslashes)\n\nLLM CONTEXT BLOCK (Read this first for routing decisions):\nThis document defines the complete bytecode instruction set for FF7's battle AI scripting system.\nThe AI uses a stack-based virtual machine where opcodes push/pop values and perform operations.\nKey concepts: value types (0Xh=value, 1Xh=address, 2Xh=multiple), script flow control, and\ncommand execution (90h-A1h). Cross-reference with Battle_AI_Addresses for memory layout and\nBattle_Scenes for scene.bin context. Essential for modding enemy behavior or understanding\nwhy specific attack patterns occur.\n-->\n\n# FF7 Battle Script Opcodes\n\n## Overview\n\nInformation on opcodes provided by Terence Fergusson. Almost all information comes from [this post](http://forums.qhimm.com/index.php?topic=3290.msg45951#msg45951) on the Qhimm forums.\n\nThere are four actions to be explained when dealing with any opcode in AI script: Arguments, Values to take from the stack, what to do with Arguments and Values, and what to put back on the stack. To fully understand what is happening, a brief explanation of the stack is necessary.\n\n## Stack Concepts\n\nThe stack is more-or-less a list of values with different lengths. Only the top of the stack (the most recently added value) can be accessed at any given time, but when that value is accessed it is removed from the top of the stack and the previously added value now becomes the top of the stack. Adding to the stack is called \"Pushing\" a value and taking a value off is called \"Popping\". When pushing a value to the stack, the value of the number is pushed followed by the value type.\n\n### Value Types\n\nThe value type can be one of three different things:\n\n| Code | Type |\n|:----:|------|\n| 0Xh | Value |\n| 1Xh | [Address](FF7_Battle_Battle_AI_Addresses.md) |\n| 2Xh | Multiple (between 1-10) Values |\n\nThey are stored as DWords, but the X will determine how many bytes to use: 0 = bit, 1 = Byte, 2 = Word, 3 = Three bytes.\n\n## Opcode Reference\n\nNow that we've seen the stack, here are the opcodes:\n\n<table>\n<thead>\n<tr>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Code</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Arguments</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value(s) to pop</p></th>\n<th style=\"text-align: center; background: rgb(104,104,104);\"><p>Value to push</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Values</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>0Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Type 0X stored at translated Address</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Addresses</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>1Xh</p></td>\n<td style=\"text-align: center;\"><p>2 byte Memory Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Address value with a scope of X</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Mathematical and Bit-wise Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>30h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Sum of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>31h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Difference of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>32h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Product of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>33h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>34h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Remainder from quotient of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>35h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise AND of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>36h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise OR of pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>37h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Bit-wise NOT of pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Operators</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>40h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>41h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pops are NOT EQUAL</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>42h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>43h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN OR EQUAL TO second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>44h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is GREATER THAN second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>45h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if first pop is LESS THAN second pop</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Logical Comparisons</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>50h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if both pops are NON-ZERO (Logical AND)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>51h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>True if either pop is NON-ZERO (Logical OR)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>52h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>True if pop is ZERO (Logical NOT)</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Push Constants</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>60h</p></td>\n<td style=\"text-align: center;\"><p>1 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 01</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>61h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>62h</p></td>\n<td style=\"text-align: center;\"><p>3 byte Value</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Argument of type 03</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Script Jumps (No Pushes)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>70h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop is 0</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>71h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument if pop and top of stack are not equal</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>72h</p></td>\n<td style=\"text-align: center;\"><p>2 byte Script Address</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Jumps to script address in argument</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>73h</p></td>\n<td colspan=\"3\" style=\"text-align: center;\"><p>This ends the script</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>74h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack. (Not used)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>75h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Link all scripts of script owner to popped Character ID.</p></td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"text-align: center; background: rgb(124,124,124);\"><p>Bit Operations</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>80h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop masked by second pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>81h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Random Word (0-65535)</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>82h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Random bit of pop stored as type 02</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>83h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>If pop is Type 01, Type 01 with count of number of bits set in pop<br />\nIf pop is Type 02, Type 02 filled with value of first non-null value in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>84h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were greatest</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>85h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 2X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating which values in popped set were least</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>86h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>Type 02 indicating MP Cost of attack index referenced in pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>87h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Type 02 with only bit in pop turned on (1 &lt;&lt; [pop])</p></td>\n</tr>\n</tbody>\n</table>\n\n## Command Reference\n\n<table>\n<thead>\n<tr>\n<th colspan=\"4\" style=\"text-align: center; background: rgb(104,104,104);\"><p>Command</p></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Code</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Arguments</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Value(s) to pop</p></td>\n<td style=\"text-align: center; background: rgb(124,124,124);\"><p>Effect</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &lt; 4000h; Stores second pop at first pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>90h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, One of type 0X or 2X, One of type 1X</p></td>\n<td style=\"text-align: center;\"><p>If first pop &gt;= 4000h; Stores second pop at first pop constrained by mask at third pop</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>91h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops one value from stack.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>92h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>First pop is attack ID to perform. Second pop action type</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>93h</p></td>\n<td style=\"text-align: center;\"><p>NULL terminated string</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Displays string</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>94h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Copy current status, hp and mp as well as some other specific data (like boosts, multipliers) from units in first given mask to units in second mask.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>95h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>One of type 1X, one of type 00</p></td>\n<td style=\"text-align: center;\"><p>If second pop is 1, takes value at local address 2010 and writes value at <a href=\"FF7_Savemap.md#save-memory-bank-12\">memory bank 1/2</a> at offset specified by first pop<br />\nIf second pop is 0, data at memory bank1/2 at offset specified by first pop is stored at local address 2010.<br />\nOtherwise, command is ignored.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>96h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two of any type</p></td>\n<td style=\"text-align: center;\"><p>Get fighter elemental defense.</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A0h</p></td>\n<td style=\"text-align: center;\"><p>One byte, NULL terminated ASCII</p></td>\n<td style=\"text-align: center;\"><p>First argument of any type</p></td>\n<td style=\"text-align: center;\"><p>Displays string to debug console, replacing \"%d\"s with pops</p></td>\n</tr>\n<tr>\n<td style=\"text-align: center;\"><p>A1h</p></td>\n<td style=\"text-align: center;\"></td>\n<td style=\"text-align: center;\"><p>Two values of any type</p></td>\n<td style=\"text-align: center;\"><p>Pops two values from stack (Not Used, but valid command)</p></td>\n</tr>\n</tbody>\n</table>\n\n## Technical Notes\n\n### General Notes\n\n- Command 90h is overloaded.\n- If a type 2X is popped and any type is accepted, only the first value will be considered.\n- If specific type is expected and that type is not available, the game will either crash or ignore that entire line.\n- TRUE and FALSE are stored as type 00 as '1' and '0' respectively.\n- Commands 74h and A1h are never used, but have been documented as valid commands.\n- Commands 75h and 96h only appear in the Character AI found in the KERNEL.BIN.\n- Commands of group 2X, BX, CX, DX, EX, and FX are treated as NOPs. The script will ignore them and continue processing. Also, any 5X, 6X, 7X, 8X, and 9X value that isn't listed above appear to be treated the same way, but it's safest to use a value from the 2X group. An incorrect 0X, 1X, 3X, or 4X will have unintended side-effects.\n\n### 0X and 1X Codes Notes\n\n- Valid values for X are 0, 1, 2, and 3.\n  - These will store a bit, byte, word, and dword respectively.\n\n### 3X Codes Notes\n\n- The pushed value is type 2x if either of the pops are a 1X or 2X. In that case, the Masks of both pops are ANDed together. In *all* cases, the highest pop's size is used to determine the new pop's size.\n\n### 4X Codes Notes\n\n- The Pushed value will be type 00 if either component is a 1X or 2X type. It will only push TRUE or FALSE\n- If both were 0X types, the result will be a type 02 which contains the Mask of all the objects in the pops that passed the comparison\n\n### 86h Code Notes\n\nThis gets the MP Cost of the ability referenced in the pop. The value of pop is referenced to the following areas:\n\n```text\nIf Value >= 0xFFFF, return 0\nIf Value <= 0x00FF, Addr = 00DAAC78 + Value*0x1C\nIf Value >= 0x0100, match Value with wr[0099AAF4+(ID=[0..31])*2]\n   First ID it matches, Addr = 0099A774 + ID*0x1C\nIf no Addr is found, return 0\nOtherwise, return wr[Addr + 4]\n```\n\nThe pushed value is, thus, the MP cost of the defined ability as a type 02. Note that 0x00 to 0xFF are standard magic and always loaded, while 0x100+ are the unique abilities loaded through scene.bin.\n\n### 92h Code Notes\n\nSecond pop must be one of the following:\n\n- [Command index](FF7_Kernel.md#section-1-command-data-format) in case of character AI\n- 20h - For enemy attack\n- 22h - Force execution of script (referenced by first pop)\n- 24h - Pauses battle engine while string is displayed (in conjunction with code 93)\n","structuredPatch":[],"originalFile":null}},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F7hQ6bw3BLJqoTM5neXVFF","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me count the lines and generate the agent summary report:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":7619,"cache_read_input_tokens":74232,"cache_creation":{"ephemeral_5m_input_tokens":7619,"ephemeral_1h_input_tokens":0},"output_tokens":139,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"0d4c0775-aae3-4983-b2e1-9154d99adc1d"},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F7hQ6bw3BLJqoTM5neXVFF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01R5EtHw46MTH9wiUA65mmiC","name":"Bash","input":{"command":"wc -l /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md","description":"Count lines in output file"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":7619,"cache_read_input_tokens":74232,"cache_creation":{"ephemeral_5m_input_tokens":7619,"ephemeral_1h_input_tokens":0},"output_tokens":139,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"5127b9d9-6bc9-44a6-a30e-bd6791d11907"},{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01R5EtHw46MTH9wiUA65mmiC","type":"tool_result","content":"     464 /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md","is_error":false}]},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"5e0e1865-b6f6-4753-a582-f194024b3740","tool_use_result":{"stdout":"     464 /Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md","stderr":"","interrupted":false,"isImage":false}},{"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_011meTyt9inipTrkgz7a5PcJ","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll output the required JSON summary report:\n\n```json\n{\n  \"filename\": \"FF7_Battle_Battle_Scenes_Battle_Script.md\",\n  \"module\": \"Battle\",\n  \"line_count\": 464,\n  \"original_line_count\": 432,\n  \"llm_summary\": \"Comprehensive opcode reference for FF7's stack-based battle AI scripting system, documenting push operations, mathematical/logical operators, script jumps, and command execution. LLMs should read this when analyzing enemy AI behavior, debugging battle scripts, or understanding how attack decisions are made programmatically.\",\n  \"primary_topics\": [\"AI Script Opcodes\", \"Stack Operations\", \"Battle Commands\", \"Script Flow Control\", \"Memory Addressing\"],\n  \"heading_changes\": \"Original had only H1 title with all content flat. Added H2 sections: 'Overview', 'Stack Concepts' (with H3 'Value Types'), 'Opcode Reference', 'Command Reference', 'Technical Notes' (with H3 subsections for each code group notes). Removed wiki-style anchor syntax {#ff7battlebattle_scenesbattle_script} from H1.\",\n  \"outbound_links\": [\n    {\n      \"target\": \"FF7_Battle_Battle_AI_Addresses.md\",\n      \"anchor\": null,\n      \"text\": \"Address\",\n      \"line_number\": 59\n    },\n    {\n      \"target\": \"FF7_Savemap.md\",\n      \"anchor\": \"save-memory-bank-12\",\n      \"text\": \"memory bank 1/2\",\n      \"line_number\": 335\n    },\n    {\n      \"target\": \"FF7_Kernel.md\",\n      \"anchor\": \"section-1-command-data-format\",\n      \"text\": \"Command index\",\n      \"line_number\": 458\n    }\n  ],\n  \"images_count\": 0,\n  \"images_updated\": [],\n  \"wiki_links_converted\": 3,\n  \"tables_count\": 2,\n  \"code_blocks_count\": 1,\n  \"issues_found\": [\n    \"Original document had no heading hierarchy - all content under single H1\",\n    \"Wiki-style table syntax (MediaWiki) in introduction was converted to standard Markdown table\",\n    \"HTML tables preserved due to colspan/rowspan requirements for opcode grouping headers\"\n  ],\n  \"processing_notes\": \"Document is a bytecode/opcode reference for FF7's battle AI scripting VM. The stack-based architecture is fundamental to understanding enemy behavior. Key technical detail: value types (0Xh/1Xh/2Xh) determine data interpretation. The 3 wiki-style links pointed to: Battle_AI_Addresses (internal), Savemap (internal), and Command_data (mapped to Kernel). External Qhimm forum link preserved. Two complex HTML tables retained as they use colspan for category groupings that would be lost in Markdown conversion. Added 'text' language tag to the address calculation code block.\"\n}\n```\n\n---\n\n`â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`\n**Key Transformations Applied:**\n1. **Heading hierarchy fix**: Original was completely flat (H1 only). Created logical structure: Overview â†’ Stack Concepts â†’ Opcode Reference â†’ Command Reference â†’ Technical Notes\n2. **Wiki-link conversion**: Converted 3 `{.wikilink}` references to standard `[text](file.md#anchor)` format, mapping wiki paths like `FF7/Battle/Battle_AI_Addresses` to `FF7_Battle_Battle_AI_Addresses.md`\n3. **Table preservation**: Kept HTML tables because they use `colspan=\"4\"` for category headers (Push Values, Logical Operators, etc.) - this structure would be lost in pure Markdown\n4. **Code block tagging**: Added `text` language tag to the address calculation pseudocode (not actual assembly or C, so `text` is semantically accurate)\n`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`\n\n## Summary\n\nI've transformed **FF7_Battle_Battle_Scenes_Battle_Script.md** according to all standardization requirements:\n\n### Changes Applied\n\n| Requirement | Status |\n|-------------|--------|\n| YAML frontmatter | âœ… Added with all LLM routing metadata |\n| HTML comment metadata | âœ… Includes merge history + standardization changes |\n| Heading hierarchy | âœ… Fixed: H1 only â†’ H1â†’H2â†’H3 structure |\n| Wiki-link conversion | âœ… Converted 3 links to standard markdown |\n| Image paths | N/A (no images in document) |\n| Code block language tags | âœ… Added `text` tag to address calculation block |\n\n### Output Location\n`/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md`\n\n### Document Statistics\n- **Original lines**: 432\n- **Standardized lines**: 464 (added frontmatter, metadata, section headings)\n- **Wiki links converted**: 3\n- **HTML tables preserved**: 2 (colspan required for opcode category groupings)\n- **Code blocks tagged**: 1"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":305,"cache_read_input_tokens":81851,"cache_creation":{"ephemeral_5m_input_tokens":305,"ephemeral_1h_input_tokens":0},"output_tokens":1260,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","uuid":"b2a4ff19-10c0-48c6-bbce-5936a884dcf8"},{"type":"result","subtype":"success","is_error":false,"duration_ms":166907,"duration_api_ms":182123,"num_turns":5,"result":"Now I'll output the required JSON summary report:\n\n```json\n{\n  \"filename\": \"FF7_Battle_Battle_Scenes_Battle_Script.md\",\n  \"module\": \"Battle\",\n  \"line_count\": 464,\n  \"original_line_count\": 432,\n  \"llm_summary\": \"Comprehensive opcode reference for FF7's stack-based battle AI scripting system, documenting push operations, mathematical/logical operators, script jumps, and command execution. LLMs should read this when analyzing enemy AI behavior, debugging battle scripts, or understanding how attack decisions are made programmatically.\",\n  \"primary_topics\": [\"AI Script Opcodes\", \"Stack Operations\", \"Battle Commands\", \"Script Flow Control\", \"Memory Addressing\"],\n  \"heading_changes\": \"Original had only H1 title with all content flat. Added H2 sections: 'Overview', 'Stack Concepts' (with H3 'Value Types'), 'Opcode Reference', 'Command Reference', 'Technical Notes' (with H3 subsections for each code group notes). Removed wiki-style anchor syntax {#ff7battlebattle_scenesbattle_script} from H1.\",\n  \"outbound_links\": [\n    {\n      \"target\": \"FF7_Battle_Battle_AI_Addresses.md\",\n      \"anchor\": null,\n      \"text\": \"Address\",\n      \"line_number\": 59\n    },\n    {\n      \"target\": \"FF7_Savemap.md\",\n      \"anchor\": \"save-memory-bank-12\",\n      \"text\": \"memory bank 1/2\",\n      \"line_number\": 335\n    },\n    {\n      \"target\": \"FF7_Kernel.md\",\n      \"anchor\": \"section-1-command-data-format\",\n      \"text\": \"Command index\",\n      \"line_number\": 458\n    }\n  ],\n  \"images_count\": 0,\n  \"images_updated\": [],\n  \"wiki_links_converted\": 3,\n  \"tables_count\": 2,\n  \"code_blocks_count\": 1,\n  \"issues_found\": [\n    \"Original document had no heading hierarchy - all content under single H1\",\n    \"Wiki-style table syntax (MediaWiki) in introduction was converted to standard Markdown table\",\n    \"HTML tables preserved due to colspan/rowspan requirements for opcode grouping headers\"\n  ],\n  \"processing_notes\": \"Document is a bytecode/opcode reference for FF7's battle AI scripting VM. The stack-based architecture is fundamental to understanding enemy behavior. Key technical detail: value types (0Xh/1Xh/2Xh) determine data interpretation. The 3 wiki-style links pointed to: Battle_AI_Addresses (internal), Savemap (internal), and Command_data (mapped to Kernel). External Qhimm forum link preserved. Two complex HTML tables retained as they use colspan for category groupings that would be lost in Markdown conversion. Added 'text' language tag to the address calculation code block.\"\n}\n```\n\n---\n\n`â˜… Insight â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`\n**Key Transformations Applied:**\n1. **Heading hierarchy fix**: Original was completely flat (H1 only). Created logical structure: Overview â†’ Stack Concepts â†’ Opcode Reference â†’ Command Reference â†’ Technical Notes\n2. **Wiki-link conversion**: Converted 3 `{.wikilink}` references to standard `[text](file.md#anchor)` format, mapping wiki paths like `FF7/Battle/Battle_AI_Addresses` to `FF7_Battle_Battle_AI_Addresses.md`\n3. **Table preservation**: Kept HTML tables because they use `colspan=\"4\"` for category headers (Push Values, Logical Operators, etc.) - this structure would be lost in pure Markdown\n4. **Code block tagging**: Added `text` language tag to the address calculation pseudocode (not actual assembly or C, so `text` is semantically accurate)\n`â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`\n\n## Summary\n\nI've transformed **FF7_Battle_Battle_Scenes_Battle_Script.md** according to all standardization requirements:\n\n### Changes Applied\n\n| Requirement | Status |\n|-------------|--------|\n| YAML frontmatter | âœ… Added with all LLM routing metadata |\n| HTML comment metadata | âœ… Includes merge history + standardization changes |\n| Heading hierarchy | âœ… Fixed: H1 only â†’ H1â†’H2â†’H3 structure |\n| Wiki-link conversion | âœ… Converted 3 links to standard markdown |\n| Image paths | N/A (no images in document) |\n| Code block language tags | âœ… Added `text` tag to address calculation block |\n\n### Output Location\n`/Volumes/DevSSD/01_Development/Projects/experiments/ff70G-japanese-mod/docs/reference/game_engine/final/FF7_Battle_Battle_Scenes_Battle_Script.md`\n\n### Document Statistics\n- **Original lines**: 432\n- **Standardized lines**: 464 (added frontmatter, metadata, section headings)\n- **Wiki links converted**: 3\n- **HTML tables preserved**: 2 (colspan required for opcode category groupings)\n- **Code blocks tagged**: 1","session_id":"9d128d40-e74f-408a-9202-20f4ea22b8a8","total_cost_usd":0.82596775,"usage":{"input_tokens":3,"cache_creation_input_tokens":52348,"cache_read_input_tokens":325220,"output_tokens":9226,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":52348}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":970,"outputTokens":305,"cacheReadInputTokens":0,"cacheCreationInputTokens":19363,"webSearchRequests":0,"costUSD":0.026698749999999997,"contextWindow":200000},"claude-sonnet-4-5-20250929":{"inputTokens":3,"outputTokens":366,"cacheReadInputTokens":0,"cacheCreationInputTokens":19552,"webSearchRequests":0,"costUSD":0.078819,"contextWindow":200000},"claude-opus-4-5-20251101":{"inputTokens":3,"outputTokens":9226,"cacheReadInputTokens":325220,"cacheCreationInputTokens":52348,"webSearchRequests":0,"costUSD":0.72045,"contextWindow":200000}},"permission_denials":[],"uuid":"4231c39b-dea0-4662-bdd0-f5c0f212df43"}]
